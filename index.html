<head>
    <meta name="darkreader-lock">
</head>
<html>
<head>
    <meta name="darkreader-lock">
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        body {
            background-color: #1a1a1a;
            overflow-x: hidden;
            padding: 0;
            border-bottom: 2px solid #4a3b32 !important;
        }
        ::-webkit-scrollbar {
            display: none;
        }
        .background[data-v-98e6f6e6] {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100dvh;
            z-index: -1;
        }
        .question {
            position: absolute;
            top: 0;
            left: 15%;
            width: 70%;
            height: 58%;
            background-color: #323232;
            background-image: url("data:image/svg+xml,%3Csvg width='70' height='70' viewBox='0 0 70 70' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%231a1a1a' fill-opacity='0.35' fill-rule='evenodd'%3E%3Cpath d='M0 0h35v35H0V0zm5 5h25v25H5V5zm5 5h15v15H10V10zm5 5h5v5h-5v-5zM40 5h25v25H40V5zm5 5h15v15H45V10zm5 5h5v5h-5v-5zM70 35H35v35h35V35zm-5 5H40v25h25V40zm-5 5H45v15h15V45zm-5 5h-5v5h5v-5zM30 40H5v25h25V40zm-5 5H10v15h15V45zm-5 5h-5v5h5v-5z'/%3E%3C/g%3E%3C/svg%3E");
            border: 2px solid #4a3b32;
            border-top: none;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
            box-shadow:
                inset 0 0 10px rgba(0, 0, 0, 0.6),
                0 5px 15px rgba(0, 0, 0, 0.5);
            padding: 20px;
            font-family: 'Noto Serif SC', 'ZCOOL XiaoWei', serif;
            color: #d4c8b8;
            box-sizing: border-box;
            transition: all 1s ease;
        }
        .up {
            position: absolute;
            top: 5%;
            left: 5%;
            width: 5%;
            aspect-ratio: 1/1;
            background-color: #1a1a1a9d;
            color: #aeffc5;
            border: 1px solid #aeffc5;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.1s ease;
            backdrop-filter: blur(3px) brightness(86%);
            z-index: 60;
        }
        .music {
            position: absolute;
            top: 5%;
            right: 5%;
            width: 5%;
            aspect-ratio: 1/1;
            background-color: #1a1a1a9d;
            color: #aeffc5;
            border: 1px solid #aeffc5;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.1s ease;
            backdrop-filter: blur(3px) brightness(86%);
            opacity: 1;
            pointer-events: all;
            z-index: 60;
        }
        .music.show {
            opacity: 1;
            pointer-events: all;
        }
        .music:hover {
            background-color: rgba(174, 255, 197, 0.2);
            border-color: #aeffc5;
            transform: scale(1.1);
        }
        .music:active {
            transform: scale(0.95);
        }
        .music svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            fill: #aeffc5;
            transition: fill 0.3s ease;
        }
        .music:hover svg {
            fill: #ffffff;
        }
        .music-slash {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .music-slash::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 85%;
            height: 3px;
            background-color: #aeffc5;
            transform: translate(-50%, -50%) rotate(45deg);
            transform-origin: center;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-radius: 1.5px;
            box-shadow: 0 0 3px rgba(174, 255, 197, 0.4);
        }
        .music.muted .music-slash {
            opacity: 1;
        }
        .music:hover .music-slash::before {
            background-color: #ffffff;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            height: 4px;
        }
        @keyframes slashAppear {
            0% {
                transform: translate(-50%, -50%) rotate(45deg) scaleX(0);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) rotate(45deg) scaleX(1);
                opacity: 1;
            }
        }
        @keyframes slashDisappear {
            0% {
                transform: translate(-50%, -50%) rotate(45deg) scaleX(1);
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                transform: translate(-50%, -50%) rotate(45deg) scaleX(0);
                opacity: 0;
            }
        }
        .music.muted .music-slash::before {
            animation: slashAppear 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        .music:not(.muted) .music-slash::before {
            animation: slashDisappear 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        .music-slash::before {
            animation-fill-mode: forwards;
        }
        @keyframes questionUP {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-100%);
            }
        }
        @keyframes questionDOWN {
            0% {
                transform: translateY(-100%);
            }
            100% {
                transform: translateY(0);
            }
        }
        @keyframes questionUPFromBottom {
            0% {
                transform: translateY(100%);
            }
            100% {
                transform: translateY(0);
            }
        }
        @keyframes choiceLeftOut {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-120vw);
                opacity: 0;
            }
        }
        @keyframes choiceRightOut {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(120vw);
                opacity: 0;
            }
        }
        @keyframes choiceLeftIn {
            0% {
                transform: translateX(-120vw);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes choiceRightIn {
            0% {
                transform: translateX(120vw);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .text {
            position: absolute;
            top: 0;
            left: 15px;
            right: 15px;
            bottom: 15px;
            background-color: rgba(20, 20, 20, 0.85);
            padding: 15px;
            padding-top: 25px;
            border-bottom-left-radius: 3.5px;
            border-bottom-right-radius: 3.5px;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.7);
            line-height: 1.8;
            color: #d4c8b8;
            border: 1px solid #3a2f28;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            font-size: 12.7px;
        }
        .text::-webkit-scrollbar {
            display: none;
        }
        .text::-webkit-scrollbar-track {
            display: none;
        }
        .text::-webkit-scrollbar-thumb {
            display: none;
        }
        .choicebox {
            position: absolute;
            width: 96%;
            left: 2%;
            top: 60%;
            height: 38%;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            align-content: space-around;
        }
        .choice {
            width: 40%;
            height: 30%;
            background-color: #1a1a1a9d;
            font-size: 16px;
            color: #aeffc5;
            font-weight: 900;
            border: 1.8px dashed #aeffc5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.1s ease;
            padding: 7px;
            backdrop-filter: blur(3px) brightness(86%);
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }
        .choice:hover {
            border: 1.8px solid #aeffc5;
        }
        .choice:active {
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        .choice.selected {
            border: 1.8px solid #aeffc5;
            background-color: rgba(174, 255, 197, 0.5);
            color: #1a1a1a;
            font-size: 16.5px;
        }
        @keyframes mobileSelectFlash {
            0% {
                background-color: #aeffc5;
                color: #1a1a1a;
                font-size: 16px;
            }
            100% {
                background-color: rgba(174, 255, 197, 0.5);
                color: #1a1a1a;
                font-size: 16.5px;
            }
        }
        .choice.mobile-flash {
            animation: mobileSelectFlash 0.2s ease-out;
        }
        .target-cursor {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            z-index: 99;
            pointer-events: none;
            mix-blend-mode: difference;
            transform: translate(-50%, -50%);
            opacity: 0;
            will-change: transform;
        }
        .link-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 98;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .link-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        .link-modal-content {
            background-color: #1a1a1a93;
            color: #aeffc5;
            border: 1.3px solid #aeffc5;
            border-radius: 5px;
            padding: 30px;
            width: 75%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.01);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .link-modal.show .link-modal-content {
            transform: scale(1);
        }
        .link-modal-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #aeffc5;
        }
        .link-modal-url {
            background-color: #1a1a1a;
            border: 1px solid #4a3b32;
            border-radius: 4px;
            padding: 12px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #d4c8b8;
            word-break: break-all;
            user-select: all;
        }
        .link-modal-button {
            color: #1a1a1a;
            border-radius: 2px;
            padding: 10px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #1a1a1a9d;
            font-size: 16px;
            color: #aeffc5;
            font-weight: 900;
            border: 1px dashed #aeffc5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.1s ease;
            padding: 7px;
            backdrop-filter: blur(3px) brightness(86%);
            user-select: none;
        }
        .link-modal-button:hover {
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        .link-modal-button:active {
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        @keyframes modalShow {
            0% {
                opacity: 0;
                transform: scale(0.01);
            }
            50% {
                opacity: 1;
                transform: scaleX(1) scaleY(0.001);
            }
            80% {
                transform: scale(1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes modalHide {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.01);
            }
        }
        .link-modal-content.show-animation {
            animation: modalShow 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        .link-modal-content.hide-animation {
            animation: modalHide 0.3s ease forwards;
        }
        .cursor-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background-color: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            will-change: transform;
        }
        .target-cursor-corner {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            border: 3px solid white;
            will-change: transform;
        }
        .corner-tl {
            border-right: none;
            border-bottom: none;
            transform: translate(-150%, -150%);
        }
        .corner-tr {
            border-left: none;
            border-bottom: none;
            transform: translate(50%, -150%);
        }
        .corner-br {
            border-left: none;
            border-top: none;
            transform: translate(50%, 50%);
        }
        .corner-bl {
            border-right: none;
            border-top: none;
            transform: translate(-150%, 50%);
        }
        .Qtitle {
            text-align: center;
            top: 0;
            left: 0;
            width: 100%;
            position: absolute;
            font-size: 16px;
            font-weight: 750;
            display: block;
        }
        emp {
            color: #ce0000;
            font-weight: 900;
        }
        body.cursor-hidden {
            cursor: none;
        }
        body.cursor-hidden * {
            cursor: none !important;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #2a2a2a;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: none;
        }
        .loading-overlay.split-animation {
            animation: none;
        }
        .line-expansion-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #2a2a2a;
            z-index: 9998;
            display: none;
        }
        .loading-overlay-top {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background-color: #2a2a2a;
            z-index: 9999;
            clip-path: polygon(0 0, 100% 0, 95% 100%, 0 100%);
            transform: translateY(0);
            transition: transform 0.62s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-bottom: 2px solid white;
        }
        .loading-overlay-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background-color: #2a2a2a;
            z-index: 9999;
            clip-path: polygon(5% 0, 100% 0, 100% 100%, 0 100%);
            transform: translateY(0);
            transition: transform 0.62s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-top: 2px solid white;
        }
        .loading-overlay-top.slide-up {
            transform: translateY(-100%);
        }
        .loading-overlay-bottom.slide-down {
            transform: translateY(100%);
        }
        @keyframes square-animation {
            0% {
                left: 0;
                top: 0;
            }
            10.5% {
                left: 0;
                top: 0;
            }
            12.5% {
                left: 32px;
                top: 0;
            }
            23% {
                left: 32px;
                top: 0;
            }
            25% {
                left: 64px;
                top: 0;
            }
            35.5% {
                left: 64px;
                top: 0;
            }
            37.5% {
                left: 64px;
                top: 32px;
            }
            48% {
                left: 64px;
                top: 32px;
            }
            50% {
                left: 32px;
                top: 32px;
            }
            60.5% {
                left: 32px;
                top: 32px;
            }
            62.5% {
                left: 32px;
                top: 64px;
            }
            73% {
                left: 32px;
                top: 64px;
            }
            75% {
                left: 0;
                top: 64px;
            }
            85.5% {
                left: 0;
                top: 64px;
            }
            87.5% {
                left: 0;
                top: 32px;
            }
            98% {
                left: 0;
                top: 32px;
            }
            100% {
                left: 0;
                top: 0;
            }
        }
        .loader {
            position: relative;
            width: 96px;
            height: 96px;
            transform: rotate(45deg);
        }
        .loader-square {
            position: absolute;
            top: 0;
            left: 0;
            width: 28px;
            height: 28px;
            margin: 2px;
            border-radius: 0px;
            background: white;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            animation: square-animation 10s ease-in-out infinite both;
        }
        .loader-square:nth-of-type(1) {
            animation-delay: 0s;
        }
        .loader-square:nth-of-type(2) {
            animation-delay: -1.4285714286s;
        }
        .loader-square:nth-of-type(3) {
            animation-delay: -2.8571428571s;
        }
        .loader-square:nth-of-type(4) {
            animation-delay: -4.2857142857s;
        }
        .loader-square:nth-of-type(5) {
            animation-delay: -5.7142857143s;
        }
        .loader-square:nth-of-type(6) {
            animation-delay: -7.1428571429s;
        }
        .loader-square:nth-of-type(7) {
            animation-delay: -8.5714285714s;
        }
        @keyframes square1-to-center {
            0% {
                left: 0px;
                top: 0px;
            }
            100% {
                left: 32px;
                top: 32px;
            }
        }
        @keyframes square2-to-center {
            0% {
                left: 64px;
                top: 0px;
            }
            100% {
                left: 32px;
                top: 32px;
            }
        }
        @keyframes square3-to-center {
            0% {
                left: 64px;
                top: 32px;
            }
            100% {
                left: 32px;
                top: 32px;
            }
        }
        @keyframes square4-stay-center {
            0% {
                left: 32px;
                top: 32px;
            }
            100% {
                left: 32px;
                top: 32px;
            }
        }
        @keyframes square5-to-center {
            0% {
                left: 32px;
                top: 64px;
            }
            100% {
                left: 32px;
                top: 32px;
            }
        }
        @keyframes square6-to-center {
            0% {
                left: 0px;
                top: 64px;
            }
            100% {
                left: 32px;
                top: 32px;
            }
        }
        @keyframes square7-to-center {
            0% {
                left: 0px;
                top: 32px;
            }
            100% {
                left: 32px;
                top: 32px;
            }
        }
        @keyframes center-square-finale {
            0% {
                transform: rotate(0deg) scale(1);
            }
            100% {
                transform: rotate(360deg) scale(0);
            }
        }
        @keyframes hide-square {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        .loader.finale .loader-square:nth-of-type(1) {
            animation: square1-to-center 0.6s ease-in-out forwards,
                hide-square 0.1s ease-in-out 0.6s forwards;
        }
        .loader.finale .loader-square:nth-of-type(2) {
            animation: square2-to-center 0.6s ease-in-out forwards,
                hide-square 0.1s ease-in-out 0.6s forwards;
        }
        .loader.finale .loader-square:nth-of-type(3) {
            animation: square3-to-center 0.6s ease-in-out forwards,
                hide-square 0.1s ease-in-out 0.6s forwards;
        }
        .loader.finale .loader-square:nth-of-type(4) {
            animation: square4-stay-center 0.6s ease-in-out forwards,
                center-square-finale 0.8s ease-in-out 0.6s forwards;
        }
        .loader.finale .loader-square:nth-of-type(5) {
            animation: square5-to-center 0.6s ease-in-out forwards,
                hide-square 0.1s ease-in-out 0.6s forwards;
        }
        .loader.finale .loader-square:nth-of-type(6) {
            animation: square6-to-center 0.6s ease-in-out forwards,
                hide-square 0.1s ease-in-out 0.6s forwards;
        }
        .loader.finale .loader-square:nth-of-type(7) {
            animation: square7-to-center 0.6s ease-in-out forwards,
                hide-square 0.1s ease-in-out 0.6s forwards;
        }
        .white-line {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 0;
            height: 2px;
            background-color: white;
            z-index: 10000;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: none;
        }
        .white-line.expand {
            animation: line-expand 0.4s ease-out forwards;
        }
        @keyframes line-expand {
            0% {
                width: 0;
                opacity: 1;
            }
            100% {
                width: 100vw;
                opacity: 1;
            }
        }
        .up {
            position: absolute;
            top: 5%;
            left: 5%;
            width: 5%;
            aspect-ratio: 1/1;
            background-color: #1a1a1a9d;
            color: #aeffc5;
            border: 1px solid #aeffc5;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.1s ease;
            backdrop-filter: blur(3px) brightness(86%);
            opacity: 0;
            pointer-events: none;
            z-index: 60;
        }
        .up.show {
            opacity: 1;
            pointer-events: all;
        }
        .up:hover {
            background-color: rgba(174, 255, 197, 0.2);
            border-color: #aeffc5;
            transform: scale(1.1);
        }
        .up:active {
            transform: scale(0.95);
        }
        .up svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            fill: #aeffc5;
            transition: fill 0.3s ease;
        }
        .up:hover svg {
            fill: #ffffff;
        }
        .progress-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background-color: rgba(26, 26, 26, 0.9);
            border-top: 1px solid #4a3b32;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }
        .progress-container {
            width: 100%;
            max-width: 600px;
            height: 4px;
            background-color: rgba(74, 59, 50, 0.3);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }
        .progress-track {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
        }
        .progress-line {
            height: 2px;
            background: linear-gradient(90deg, #4a3b32, #aeffc5);
            border-radius: 1px;
            transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 4px rgba(174, 255, 197, 0.3);
        }
        .progress-segments {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2px;
            box-sizing: border-box;
        }
        .progress-dot {
            width: 6px;
            height: 6px;
            background-color: #4a3b32;
            border-radius: 50%;
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            z-index: 2;
            border: 1px solid rgba(74, 59, 50, 0.5);
        }
        .progress-dot.active {
            background-color: #aeffc5;
            border-color: #aeffc5;
            box-shadow: 0 0 8px rgba(174, 255, 197, 0.4);
            transform: scale(1.2);
        }
        .progress-dot.completed {
            background-color: #aeffc5;
            border-color: #aeffc5;
            box-shadow: 0 0 6px rgba(174, 255, 197, 0.3);
        }
        @keyframes progressPulse {
            0% {
                box-shadow: 0 0 8px rgba(174, 255, 197, 0.4);
            }
            50% {
                box-shadow: 0 0 12px rgba(174, 255, 197, 0.6);
            }
            100% {
                box-shadow: 0 0 8px rgba(174, 255, 197, 0.4);
            }
        }
        .progress-dot.active {
            animation: progressPulse 2s ease-in-out infinite;
        }
        .skip-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 98;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .skip-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        .skip-modal-content {
            background-color: #1a1a1a93;
            color: #aeffc5;
            border: 1.3px solid #aeffc5;
            border-radius: 5px;
            padding: 30px;
            width: 75%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.01);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .skip-modal.show .skip-modal-content {
            transform: scale(1);
        }
        .player-settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 98;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .player-settings-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        .player-settings-modal-content {
            background-color: #1a1a1a93;
            color: #aeffc5;
            border: 1.3px solid #aeffc5;
            border-radius: 5px;
            padding: 30px;
            width: 75%;
            max-height: 75%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.01);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(3px) brightness(86%);
        }
        .player-settings-modal.show .player-settings-modal-content {
            transform: scale(1);
        }
        .player-settings-modal-content.show-animation {
            animation: modalShow 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        .player-settings-modal-content.hide-animation {
            animation: modalHide 0.3s ease forwards;
        }
        .player-settings-modal-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #aeffc5;
            text-align: center;
            line-height: 1.5;
        }
        .player-settings-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .form-label {
            color: #aeffc5;
            font-size: 14px;
            font-weight: bold;
        }
        .form-textarea {
            background-color: #1a1a1a;
            border: 1px solid #4a3b32;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Noto Serif SC', 'ZCOOL XiaoWei', serif;
            font-size: 14px;
            color: #d4c8b8;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s ease;
        }
        .form-textarea:focus {
            outline: none;
            border-color: #aeffc5;
            box-shadow: 0 0 5px rgba(174, 255, 197, 0.3);
        }
        .form-textarea::placeholder {
            color: #666;
        }
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        .modal-button {
            background-color: #1a1a1a9d;
            color: #aeffc5;
            border: 1px dashed #aeffc5;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.1s ease;
            backdrop-filter: blur(3px) brightness(86%);
            user-select: none;
        }
        .modal-button:hover {
            background-color: #aeffc5;
            color: #1a1a1a;
            border-style: solid;
        }
        .modal-button.copy-button {
            background-color: rgba(174, 255, 197, 0.1);
        }
        .modal-button.copy-button:hover {
            background-color: #aeffc5;
        }
        .settings-preview {
            margin-top: 25px;
            border-top: 1px solid #4a3b32;
            padding-top: 20px;
        }
        .preview-title {
            color: #aeffc5;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        .preview-content {
            background-color: #1a1a1a;
            border: 1px solid #4a3b32;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #d4c8b8;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            user-select: all;
            line-height: 1.4;
        }
        .preview-placeholder {
            color: #666;
            font-style: italic;
            text-align: center;
            font-family: 'Noto Serif SC', 'ZCOOL XiaoWei', serif;
        }
        .preview-content::-webkit-scrollbar {
            width: 6px;
        }
        .preview-content::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 3px;
        }
        .preview-content::-webkit-scrollbar-thumb {
            background: #4a3b32;
            border-radius: 3px;
        }
        .preview-content::-webkit-scrollbar-thumb:hover {
            background: #aeffc5;
        }
        .skip-modal.show .skip-modal-content {
            transform: scale(1);
        }
        .skip-modal-content.show-animation {
            animation: modalShow 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        .skip-modal-content.hide-animation {
            animation: modalHide 0.3s ease forwards;
        }
        .skip-modal-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #aeffc5;
        }
        .skip-modal-description {
            font-size: 14px;
            margin-bottom: 20px;
            color: #d4c8b8;
            line-height: 1.6;
        }
        .skip-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        .skip-modal-button {
            color: #1a1a1a;
            border-radius: 2px;
            padding: 10px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #1a1a1a9d;
            font-size: 16px;
            color: #aeffc5;
            font-weight: 900;
            border: 1px dashed #aeffc5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.1s ease;
            padding: 7px;
            backdrop-filter: blur(3px) brightness(86%);
            user-select: none;
        }
        .skip-modal-button:hover {
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        .skip-modal-button:active {
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        .name-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 98;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .name-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        .name-modal-content {
            background-color: #1a1a1a93;
            color: #aeffc5;
            border: 1.3px solid #aeffc5;
            border-radius: 5px;
            padding: 30px;
            width: 75%;
            max-height: 80%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.01);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .name-modal.show .name-modal-content {
            transform: scale(1);
        }
        .name-modal-content.show-animation {
            animation: modalShow 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        .name-modal-content.hide-animation {
            animation: modalHide 0.3s ease forwards;
        }
        .name-modal-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #aeffc5;
        }
        .name-input {
            background-color: #1a1a1a;
            border: 1px solid #4a3b32;
            border-radius: 4px;
            padding: 12px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #d4c8b8;
            word-break: break-all;
            user-select: all;
            width: 100%;
            box-sizing: border-box;
        }
        .name-input:focus {
            outline: none;
            border-color: #aeffc5;
        }
        .name-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        .name-modal-button {
            color: #1a1a1a;
            border-radius: 2px;
            padding: 10px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #1a1a1a9d;
            color: #aeffc5;
            font-weight: 900;
            border: 1px dashed #aeffc5;
            border-radius: 8px;
            transition: all 0.1s ease;
            padding: 7px;
            backdrop-filter: blur(3px) brightness(86%);
            user-select: none;
        }
        .name-modal-button:hover {
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        .name-modal-button:active {
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        .final-page {
            position: fixed;
            top: 100%;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(64, 64, 64, 0.1);
            z-index: 50;
            transition: top 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .final-page.show {
            top: 0;
        }
        .post {
            position: absolute;
            width: calc(33.333% - 10px);
            height: auto;
            background-color: #1a1a1a9d;
            font-size: 12px;
            color: var(--postcolor, #aeffc5);
            font-weight: 900;
            border: 1.5px solid var(--postcolor, #aeffc5);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 7px;
            backdrop-filter: blur(3px) brightness(86%);
            box-sizing: border-box;
            border-bottom-left-radius: 2px;
        }
        .post:active {
            transform: scale(0.96);
        }
        .post-image {
            position: static;
            width: 100%;
            display: block;
            background-image: url('data:image/svg+xml,%3Csvg%20t%3D%221756471533178%22%20class%3D%22icon%22%20viewBox%3D%220%200%201024%201024%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20p-id%3D%221564%22%20width%3D%22200%22%20height%3D%22200%22%3E%3Cpath%20d%3D%22M799.658667%20531.584A224.64%20224.64%200%200%201%201024%20756.437333C1024%20880.64%20923.562667%20981.333333%20799.658667%20981.333333a224.64%20224.64%200%200%201-224.298667-224.853333c0-124.202667%20100.437333-224.896%20224.298667-224.896z%20m24.192%20311.594667h-49.664v51.2h49.664v-51.2zM899.754667%2042.666667c36.608%200%2066.133333%2029.781333%2066.133333%2066.304v406.698666a290.346667%20290.346667%200%200%200-166.357333-52.096%20290.56%20290.56%200%200%200-157.866667%2046.421334l-52.992-51.797334a10.496%2010.496%200%200%200-14.848%200L364.970667%20662.613333a10.666667%2010.666667%200%200%201-16-1.28l-92.544-124.586666a10.538667%2010.538667%200%200%200-16.981334%200L98.773333%20726.186667a10.666667%2010.666667%200%200%200%208.576%2017.066666h400.298667c-0.128%204.48-0.256%208.96-0.256%2013.44%200%2029.397333%204.352%2057.728%2012.416%2084.565334H66.176C29.568%20841.258667%200%20811.477333%200%20774.912V108.970667C0%2072.277333%2029.696%2042.666667%2066.133333%2042.666667z%20m-73.088%20576h-53.76l6.528%20202.197333v1.28h39.168l8.106666-203.477333zM251.221333%20197.546667a86.485333%2086.485333%200%200%200%200%20172.885333%2086.4%2086.4%200%200%200%2086.229334-86.442667%2086.4%2086.4%200%200%200-86.229334-86.485333z%22%20fill%3D%22%23e6e6e6%22%20p-id%3D%221565%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 72px 72px;
        }
        .post-image.image-error {
            min-height: 128px;
        }
        .post-image.image-error img {
            display: none;
        }
        .post-image img {
            display: block;
            width: 100%;
            height: auto;
            min-height: 72px;
        }
        .post-title {
            display: block;
            margin-top: 5px;
            font-size: 15.3px;
            font-weight: 950;
            text-align: left;
            line-height: 1.4;
            color: var(--postcolor);
        }
        .post-text {
            display: block;
            margin-top: 8px;
            font-size: 12px;
            font-weight: 500;
            color: var(--postcolor, #aeffc5);
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            line-height: 1.6;
            text-align: left;
        }
        .questionnaire-end .question {
            animation: questionUP 1s ease forwards;
        }
        .questionnaire-end .choice.left {
            animation: choiceLeftOut 1s ease forwards;
        }
        .questionnaire-end .choice.right {
            animation: choiceRightOut 1s ease forwards;
        }
        .questionnaire-end .progress-nav {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .questionnaire-end .up {
            animation: upButtonOut 1s ease forwards;
        }
        @keyframes upButtonOut {
            0% {
                opacity: 1;
                transform: scale(1) translateX(0);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateX(-100px);
            }
        }
        @keyframes upButtonRightOut {
            0% {
                opacity: 1;
                transform: scale(1) translateX(0);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateX(-120vw);
            }
        }
        .questionnaire-end .music {
            position: absolute !important;
            top: 1% !important;
            right: 2% !important;
            width: 5% !important;
            height: auto !important;
            aspect-ratio: 1/1 !important;
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        }
        @media only screen and (max-width: 652px) {
            .question {
                position: absolute;
                top: 0;
                left: 3%;
                width: 94%;
                height: 50%;
            }
            .choicebox {
                position: absolute;
                width: 97%;
                left: 1.5%;
                top: 62%;
                height: 38%;
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-between;
                align-items: center;
                align-content: space-around;
            }
            .choice {
                width: 40%;
                height: 20%;
                font-size: 16px;
                color: #aeffc5;
                font-weight: 900;
            }
            .text {
                font-size: 11.2px;
            }
            .Qtitle {
                font-size: 16px;
            }
            .up {
                position: absolute;
                top: 50.5%;
                left: 5%;
                width: auto;
                height: 8%;
                aspect-ratio: 1/1;
                z-index: 100;
            }
            .music {
                position: absolute;
                top: 50.5%;
                right: 5%;
                width: auto;
                height: 8%;
                aspect-ratio: 1/1;
                z-index: 100;
            }
            .final-page-exists .music {
                width: 10% !important;
                height: auto !important;
                aspect-ratio: 1/1 !important;
                right: 2%;
                top: 1%;
            }
            .progress-nav {
                height: 10px;
                padding: 0 15px;
            }
            .progress-container {
                height: 5px;
            }
            .progress-line {
                height: 3px;
            }
            .progress-dot {
                width: 8px;
                height: 8px;
            }
        }
        .cg-roll-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 98;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .cg-roll-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        .cg-roll-modal-content {
            background-color: #1a1a1a93;
            color: #aeffc5;
            border: 1.3px solid #aeffc5;
            border-radius: 5px;
            padding: 30px;
            width: 75%;
            max-height: 75%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.01);
            backdrop-filter: blur(3px) brightness(86%);
        }
        .cg-roll-modal.show .cg-roll-modal-content {
            transform: scale(1);
        }
        .cg-roll-modal-content.show-animation {
            animation: modalShow 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        .cg-roll-modal-content.hide-animation {
            animation: modalHide 0.3s ease forwards;
        }
        .cg-roll-modal-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 1px solid #4a3b32;
            padding-bottom: 15px;
        }
        .cg-roll-modal-header h2 {
            font-size: 20px;
            color: #aeffc5;
            margin: 0;
        }
        .cg-roll-section {
            margin-bottom: 25px;
        }
        .cg-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .cg-section-header h3 {
            font-size: 16px;
            color: #aeffc5;
            margin: 0;
        }
        .cg-refresh-btn {
            background-color: #1a1a1a9d;
            color: #aeffc5;
            border: 1px dashed #aeffc5;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(3px) brightness(86%);
        }
        .cg-refresh-btn:hover {
            border-style: solid;
            background-color: rgba(174, 255, 197, 0.2);
        }
        .cg-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .cg-item {
            background-color: #1a1a1a9d;
            border: 1px dashed #4a3b32;
            border-radius: 4px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(3px) brightness(86%);
            font-size: 13px;
            line-height: 1.4;
            color: #d4c8b8;
        }
        .cg-item:hover {
            border-color: #aeffc5;
            border-style: solid;
        }
        .cg-item.selected {
            border-color: #aeffc5;
            border-style: solid;
            background-color: rgba(174, 255, 197, 0.2);
            color: #aeffc5;
        }
        .cg-item-title {
            font-weight: bold;
            color: #aeffc5;
            margin-bottom: 5px;
        }
        .cg-selection-display {
            background-color: rgba(26, 26, 26, 0.5);
            border: 1px solid #4a3b32;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .selected-cg {
            margin-bottom: 15px;
        }
        .selected-cg:last-child {
            margin-bottom: 0;
        }
        .selected-cg h4 {
            font-size: 14px;
            color: #aeffc5;
            margin: 0 0 8px 0;
        }
        .selected-content {
            background-color: #1a1a1a;
            border: 1px solid #4a3b32;
            border-radius: 3px;
            padding: 10px;
            font-size: 12px;
            line-height: 1.4;
            color: #d4c8b8;
            min-height: 40px;
            user-select: all;
            cursor: text;
        }
        .cg-modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .cg-load-btn {
            background-color: #1a1a1a9d;
            color: #aeffc5;
            border: 1px dashed #aeffc5;
            border-radius: 6px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(3px) brightness(86%);
        }
        .cg-load-btn:hover {
            border-style: solid;
            background-color: #aeffc5;
            color: #1a1a1a;
        }
        .cg-load-btn.error {
            border-color: #ce0000;
            background-color: rgba(206, 0, 0, 0.2);
            color: #ce0000;
        }
        .cg-load-btn.success {
            border-color: #aeffc5;
            background-color: rgba(174, 255, 197, 0.3);
            color: #aeffc5;
        }
        .cg-success-message {
            text-align: center;
            margin-top: 15px;
            font-size: 12px;
            color: #888;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .cg-success-message.show {
            opacity: 1;
        }
        .modal-content-section {
            margin-bottom: 25px;
            border-bottom: 1px solid #32454a;
            padding-bottom: 20px;
        }
        .modal-content-section:last-of-type {
            border-bottom: none;
            margin-bottom: 20px;
        }
        .modal-content-section h3 {
            font-size: 16px;
            color: #f1aeff;
            margin: 0 0 12px 0;
            text-align: left;
            font-weight: 800;
        }
        .content-detail {
            padding-top: 8px;
            padding-left: 6px;
            font-size: 13px;
            line-height: 1.1;
            color: #aeffc5;
            text-align: left;
        }
        .work-link {
            color: #f1aeff;
            text-decoration: none;
            transition: all 0.2s ease;
            border-bottom: 1px dashed #aeffc5;
            padding-bottom: 2px;
        }
        .work-link:hover {
            color: #ffffff;
            border-bottom: 1px solid #ffffff;
            text-shadow: 0 0 5px #f1aeff7a;
        }
        .work-link:active {
            color: #aef3ff;
        }
        @media (max-width: 652px) {
            .cg-roll-modal-content {
                width: 95%;
                padding: 20px;
            }
            .cg-list {
                grid-template-columns: 1fr;
            }
            .cg-roll-modal-header h2 {
                font-size: 18px;
            }
            .modal-content-section h3 {
                font-size: 15px;
            }
            .content-detail {
                font-size: 12px;
                padding-top: 6px;
                padding-left: 4px;
            }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loader">
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
            <div class="loader-square"></div>
        </div>
    </div>
    <div id="lineExpansionOverlay" class="line-expansion-overlay"></div>
    <div id="whiteLine" class="white-line"></div>
    <div id="loadingOverlayTop" class="loading-overlay-top" style="display: none;"></div>
    <div id="loadingOverlayBottom" class="loading-overlay-bottom" style="display: none;"></div>
    <div id="app">
        <canvas ref="backgroundCanvas" class="background" data-v-98e6f6e6></canvas>
        <div class="welcome_canvas"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; pointer-events: none;">
        </div>
    </div>
    <div id="targetCursor" class="target-cursor">
        <div class="cursor-center"></div>
        <div class="target-cursor-corner corner-tl"></div>
        <div class="target-cursor-corner corner-tr"></div>
        <div class="target-cursor-corner corner-br"></div>
        <div class="target-cursor-corner corner-bl"></div>
    </div>
    <!---->
    <div class="up cursor-target left">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
        </svg>
    </div>
    <!---->
    <div class="music cursor-target right">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
        </svg>
        <div class="music-slash"></div>
    </div>
    <!---->
    <div id="linkModal" class="link-modal left">
        <div class="link-modal-content">
            <div class="link-modal-title"></div>
            <div id="linkModalUrl" class="link-modal-url"></div>
            <button id="linkModalCopy" class="link-modal-button cursor-target"></button>
        </div>
    </div>
    <!---->
    <div id="inputModal" class="link-modal">
        <div class="link-modal-content">
            <div id="inputModalTitle" class="link-modal-title"></div>
            <input type="text" id="inputModalText" class="link-modal-url" placeholder="..."
                style="background-color: #1a1a1a; border: 1px solid #4a3b32; color: #d4c8b8; outline: none;z-index: 150;">
            <button id="inputModalConfirm" class="link-modal-button cursor-target"></button>
        </div>
    </div>
    <!---->
    <div id="skipModal" class="skip-modal">
        <div class="skip-modal-content">
            <div class="skip-modal-title"></div>
            <div class="skip-modal-description"></div>
            <div class="skip-modal-buttons">
                <button id="skipCancel" class="skip-modal-button cursor-target"></button>
                <button id="skipConfirm" class="skip-modal-button cursor-target"></button>
            </div>
        </div>
    </div>
    <!-- -->
    <div id="returnModal" class="skip-modal">
        <div class="skip-modal-content">
            <div class="skip-modal-title"></div>
            <div class="skip-modal-description"></div>
            <div class="skip-modal-buttons">
                <button id="returnCancel" class="skip-modal-button cursor-target"></button>
                <button id="returnConfirm" class="skip-modal-button cursor-target"></button>
            </div>
        </div>
    </div>
    <!---->
    <div id="nameModal" class="name-modal">
        <div class="name-modal-content">
            <div class="name-modal-title"></div>
            <input type="text" id="nameInput" class="name-input" placeholder="..." maxlength="20"
                style="z-index: 150;">
            <div class="name-modal-buttons">
                <button id="nameCancel" class="name-modal-button cursor-target"></button>
                <button id="nameConfirm" class="name-modal-button cursor-target"></button>
            </div>
        </div>
    </div>
    <!---->
    <div id="gameInfoModal" class="name-modal">
        <div class="name-modal-content">
            <div class="name-modal-title"></div>
            <div class="skip-modal-description"></div>
            <div id="gameInfoContent" class="name-input"
                style="white-space: pre-line; user-select: all; cursor: text; height: auto; min-height: 120px; padding: 15px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.4; overflow-y: auto;">
            </div>
            <div class="name-modal-buttons">
                <button id="gameInfoCopy" class="name-modal-button cursor-target"></button>
                <button id="gameInfoClose" class="name-modal-button cursor-target"></button>
            </div>
        </div>
    </div>
    <!---->
    <div id="playerSettingsModal" class="player-settings-modal">
        <div class="player-settings-modal-content">
            <div class="player-settings-modal-title">
                BOSS
            </div>
            <div class="skip-modal-description"><emp></emp><emp></emp><br>
                </div>
            <form class="player-settings-form">
                <div class="form-group">
                    <label class="form-label" for="userAppearance"></label>
                    <textarea id="userAppearance" class="form-textarea" placeholder="..."
                        rows="3" oninput="updatePreview()"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="executionCG">CG</label>
                    <textarea id="executionCG" class="form-textarea" placeholder="..." rows="3"
                        oninput="updatePreview()"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="defeatCG">CG</label>
                    <textarea id="defeatCG" class="form-textarea" placeholder="..." rows="3"
                        oninput="updatePreview()"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="additionalSettings"></label>
                    <textarea id="additionalSettings" class="form-textarea" placeholder="..."
                        rows="4" oninput="updatePreview()"></textarea>
                </div>
            </form>
            <div class="modal-buttons">
                <button type="button" class="modal-button copy-button" onclick="copyPlayerSettings()">
                    
                </button>
                <button type="button" class="modal-button" onclick="hidePlayerSettingsModal()">
                    
                </button>
            </div>
            <div class="settings-preview">
                <div class="preview-title"></div>
                <div class="preview-content" id="settingsPreview">
                    <div class="preview-placeholder"></div>
                </div>
            </div>
        </div>
    </div>
    <!---->
    <div id="resetModal" class="skip-modal">
        <div class="skip-modal-content">
            <div class="skip-modal-title"></div>
            <div class="skip-modal-description"></div>
            <div class="skip-modal-buttons">
                <button id="resetCancel" class="skip-modal-button cursor-target"></button>
                <button id="resetConfirm" class="skip-modal-button cursor-target"></button>
            </div>
        </div>
    </div>
    <!--CG-->
    <div id="cgRollModal" class="cg-roll-modal">
        <div class="cg-roll-modal-content">
            <div class="cg-roll-modal-header">
                <h2>CG/CG</h2>
            </div>
            <div class="skip-modal-description">CG<emp></emp></div>
            <div class="cg-roll-section">
                <div class="cg-section-header">
                    <h3>CG</h3>
                    <button class="cg-refresh-btn cursor-target" onclick="refreshExecutionCGs()"></button>
                </div>
                <div class="cg-list" id="executionCGList">
                </div>
            </div>
            <div class="cg-roll-section">
                <div class="cg-section-header">
                    <h3>CG</h3>
                    <button class="cg-refresh-btn cursor-target" onclick="refreshDefeatCGs()"></button>
                </div>
                <div class="cg-list" id="defeatCGList">
                </div>
            </div>
            <div class="cg-selection-display">
                <div class="selected-cg">
                    <h4>CG</h4>
                    <div class="selected-content" id="selectedExecutionCG"></div>
                </div>
                <div class="selected-cg">
                    <h4>CG</h4>
                    <div class="selected-content" id="selectedDefeatCG"></div>
                </div>
            </div>
            <div class="cg-modal-buttons">
                <button class="cg-load-btn cursor-target" onclick="loadSelectedCGs()"></button>
            </div>
            <div class="cg-success-message" id="cgSuccessMessage">
                <span style="color:#c57712"></span>
            </div>
        </div>
    </div>
    <!---->
    <div id="baseCommandModal" class="cg-roll-modal">
        <div class="cg-roll-modal-content">
            <div class="cg-roll-modal-header">
                <h2></h2>
            </div>
            <div class="skip-modal-description"></div>
            <div class="modal-content-section">
                <h3></h3>
                <div class="content-detail">
                    AI"xxxx"<br>
                    
                </div>
            </div>
            <div class="modal-content-section">
                <h3></h3>
                <div class="content-detail">
                    AI<br>
                    
                </div>
            </div>
            <div class="cg-modal-buttons">
                <button class="cg-load-btn cursor-target" onclick="hideBaseCommandModal()"></button>
            </div>
        </div>
    </div>
    <!---->
    <div id="announcementModal" class="cg-roll-modal">
        <div class="cg-roll-modal-content">
            <div class="cg-roll-modal-header">
                <h2></h2>
            </div>
            <div class="skip-modal-description">BUG~xux</div>
            <div class="modal-content-section">
                <h3>[2025-8-31]v0.01</h3>
                <div class="content-detail">
                    BUG<br>
                    quq<br>
                    
                </div>
            </div>
            <div class="modal-content-section">
                <h3>[2025-9-2]v0.03</h3>
                <div class="content-detail">
                    1.<br>
                    2.<br>
                    3.<br>
                    4.x
                </div>
            </div>
            <div class="modal-content-section">
                <h3>[2025-9-6]v0.04</h3>
                <div class="content-detail">
                    1./NPC<br>
                    2.
                </div>
            </div>
            <div class="cg-modal-buttons">
                <button class="cg-load-btn cursor-target" onclick="hideAnnouncementModal()"></button>
            </div>
        </div>
    </div>
    <!--Q&A-->
    <div id="qaModal" class="cg-roll-modal">
        <div class="cg-roll-modal-content">
            <div class="cg-roll-modal-header">
                <h2></h2>
            </div>
            <div class="skip-modal-description"></div>
            <div class="modal-content-section">
                <h3>Q:UI//</h3>
                <div class="content-detail">
                    A: 
                </div>
            </div>
            <div class="modal-content-section">
                <h3>Q:</h3>
                <div class="content-detail">
                    A: <span style="color:#c57712">""</span>""
                </div>
            </div>
        </div>
    </div>
    <!---->
    <div id="otherWorksModal" class="cg-roll-modal">
        <div class="cg-roll-modal-content">
            <div class="cg-roll-modal-header">
                <h2></h2>
            </div>
            <div class="skip-modal-description">~</div>
            <div class="modal-content-section">
                <h3><a href="https://aigirlfriend.baby/zh/explore/installed/eeee44e1-7857-49a0-9fd9-d54956925545" target="_blank" class="work-link cursor-target"></a></h3>
                <div class="content-detail">
                    M(x
                </div>
            </div>
            <div class="cg-modal-buttons">
                <button class="cg-load-btn cursor-target" onclick="hideOtherWorksModal()"></button>
            </div>
        </div>
    </div>
    <!---->
    <div id="finalPage" class="final-page">
        <div class="post cursor-target" style="--postcolor: #c52d12;" onclick="returnModalController.show()">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/return.png" /></div>
            <div class="post-title">[]</div>
            <div class="post-text"></div>
        </div>
        <div class="post cursor-target" style="--postcolor: #c57712;" onclick="gameInfoController.show()">
            <div class="post-image"><img
                    src="https://cloudflare-imgbed-ehf.pages.dev/file/cf90db4e-52a2-4d38-809a-0566f73aab9a.png" /></div>
            <div class="post-title">[]</div>
            <div class="post-text"></div>
        </div>
        <div class="post cursor-target" style="--postcolor: #c57712;" onclick="showPlayerSettingsModal()">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/bosspost.png" /></div>
            <div class="post-title">[]</div>
            <div class="post-text">BOSS</div>
        </div>
        <div class="post cursor-target" style="--postcolor: #aeffc5;" onclick="showCGRollModal()">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/defeatpost.png" /></div>
            <div class="post-title">[]ROLL/CG</div>
            <div class="post-text"><emp>()</emp>rollAICG</div>
        </div>
        <div class="post cursor-target" style="--postcolor: #ae12c5;" onclick="showBaseCommandModal()">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/basecommand.png" /></div>
            <div class="post-title">[]</div>
            <div class="post-text"></div>
        </div>
        <div class="post cursor-target" style="--postcolor: #1266c5;" onclick="showAnnouncementModal()">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/Announcementpost.png" />
            </div>
            <div class="post-title">[]</div>
            <div class="post-text">~xux</div>
        </div>
        <div class="post cursor-target" style="--postcolor: #d4d4d4;"
            onclick="window.open('https://qun.qq.com/universal-share/share?ac=1&authKey=zdPsFwpJYOHiD8GhwAHNnbKFDx282p1X93mfxf%2F8uCSRXRF%2BaXdwNBIv4QOUm7pA&busi_data=eyJncm91cENvZGUiOiI5OTE1MTU0MjciLCJ0b2tlbiI6Ilc1MzNQeUpXZmxZd3hpWG1GMUVBOWI0ZjhBQlo5ZTBYWkZEWUpCOGI2T2NoVTc1d3REcFo5bW1NdjFHSkxHZ3giLCJ1aW4iOiIxNDIyOTQ1MTA1In0%3D&data=QiurWUwLct3d_vg7A2ZxhaYKeaCzADIyG8T1rWgSpuTX8MKHvNWonPEBdFZzD813AXQAFCslwEiLYAxh-VhIGw&svctype=4&tempid=h5_group_info', '_blank')">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/grouppost.png" /></div>
            <div class="post-title">[]QQ<br>1422945105</div>
            <div class="post-text">ovo</div>
        </div>
        <div class="post cursor-target" style="--postcolor: #ae12c5;" onclick="showQAModal()">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/QandApost.png" /></div>
            <div class="post-title">[]Q & A</div>
            <div class="post-text"></div>
        </div>
        <div class="post cursor-target" style="--postcolor: #d4d4d4;" onclick="showOtherWorksModal()">
            <div class="post-image"><img src="https://cloudflare-imgbed-ehf.pages.dev/file/otherpost.png" /></div>
            <div class="post-title">[]</div>
            <div class="post-text">~</div>
        </div>
    </div>
    <div class="question" q="1">
        <div class="text">
            <div class="Qtitle"></div>
            <p></p>
            <p></p>
            <p></p>
            <p style="margin-top:10px;">UI<emp></emp><emp></emp><emp>APP
                </emp>AI<emp></emp>
                <emp></emp></p>
            <p></p>
        </div>
    </div>
    <div class="question" q="2" style="display: none; transform: translateY(-100%);">
        <div class="text">
            <div class="Qtitle">&</div>
            <p>MMOrpg-</p>
            <p></p>
            <p><emp>BOSS</emp></p>
            <p>BOSS</p>
            <p>BOSS<emp></emp></p>
        </div>
    </div>
    <div class="question" q="3" style="display: none; transform: translateY(-100%);">
        <div class="text">
            <div class="Qtitle">&</div>
            <p>()</p>
            <p></p>
            <p></p>
            <p></p>
            <p><emp></emp></p>
        </div>
    </div>
    <div class="question" q="4" style="display: none; transform: translateY(-100%);">
        <div class="text">
            <div class="Qtitle">&</div>
            <p><emp></emp></p>
            <p><emp></emp><emp></emp><emp></emp></p>
            <p><emp></emp></p>
            <p><emp>(NPC)</emp><emp></emp></p>
        </div>
    </div>
    <div class="question" q="5" style="display: none; transform: translateY(-100%);">
        <div class="text">
            <div class="Qtitle"></div>
            <p></p>
            <p></p>
            <p><emp></emp></p>
        </div>
    </div>
    <div class="question" q="6" style="display: none; transform: translateY(-100%);">
        <div class="text">
            <div class="Qtitle"></div>
            <p></p>
            <p><emp></emp></p>
            <p>
                <emp></emp>
            </p>
            <p>
                <emp></emp>
            </p>
            <p>
                <emp></emp>
            </p>
        </div>
    </div>
    <div class="question" q="7" style="display: none; transform: translateY(-100%);">
        <div class="text">
            <div class="Qtitle"></div>
            <p><emp></emp>TA</p>
            <p></p>
            <p>TA<emp></emp>
            </p>
        </div>
    </div>
    <div class="question" q="8" style="display: none; transform: translateY(-100%);">
        <div class="text">
            <div class="Qtitle"></div>
            <p></p>
            <p><emp></emp></p>
            <p></p>
        </div>
    </div>
    <div class="progress-nav">
        <div class="progress-container">
            <div class="progress-track">
                <div class="progress-line" id="progressLine"></div>
                <div class="progress-segments" id="progressSegments">
                </div>
            </div>
        </div>
    </div>
    <div class="choicebox">
        <!--1-->
        <div class="choice cursor-target left" q="1" action="link">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="1" action="next">
            <p></p>
        </div>
        <div class="choice cursor-target left" q="1" action="skip">
            <p></p>
        </div>
        <!--2-->
        <div class="choice cursor-target left" q="2" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="2" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target left" q="2" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="2" action="input" style="display: none;">
            <p>()</p>
        </div>
        <!--3-->
        <div class="choice cursor-target left" q="3" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="3" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target left" q="3" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="3" action="next" style="display: none;">
            <p></p>
        </div>
        <!--4-->
        <div class="choice cursor-target left" q="4" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="4" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target left" q="4" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="4" action="input" style="display: none;">
            <p>()</p>
        </div>
        <!--5-->
        <div class="choice cursor-target left" q="5" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="5" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target left" q="5" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="5" action="input" style="display: none;">
            <p>()</p>
        </div>
        <!--6-->
        <div class="choice cursor-target left" q="6" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="6" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target left" q="6" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="6" action="next" style="display: none;">
            <p></p>
        </div>
        <!--7-->
        <div class="choice cursor-target left" q="7" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="7" action="next" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target left" q="7" action="next" style="display: none;">
            <p></p>
        </div>
        <!--8-->
        <div class="choice cursor-target left" q="8" action="restart" style="display: none;">
            <p></p>
        </div>
        <div class="choice cursor-target right" q="8" action="start" style="display: none;">
            <p></p>
        </div>
    </div>
    <script>
        const globalConfig = {
            background: {
                pointSpacing: 20, 
                mouseRadius: 120,    
                animationSpeed: 0.12, 
                opacity: {
                    default: 0,       
                    active: 0.6,      
                    transition: 0.15  
                },
                colors: {
                    point: "rgb(174, 255, 197, 1)", 
                    text: "rgba(244, 164, 67, 1)",  
                    glow: "rgba(239, 198, 75, 0.5)" 
                }
            },
            particles: {
                count: {
                    user: 250,   
                    agent: 125   
                },
                speed: 0.07,     
                spacing: 3,      
                interaction: {
                    radius: 110, 
                    force: 0.55   
                }
            }
        };
        const mathUtils = {
            lerp: (start, end, factor) => start + (end - start) * factor,
            distance: (x1, y1, x2, y2) => Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2),
            normalize: (value, min, max) => (value - min) / (max - min),
            clamp: (value, min, max) => Math.min(Math.max(value, min), max),
            easeInOut: (t) => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t
        };
        const backgroundController = {
            canvas: null,
            ctx: null,
            width: 0,
            height: 0,
            points: [],
            line: 0,
            row: 0,
            distance: 0,
            mouse: {
                x: 0,
                y: 0,
                radius: globalConfig.background.mouseRadius,
                timer: null,
                if_moving: false
            },
            init() {
                this.canvas = document.querySelector(".background");
                if (!this.canvas) {
                    console.error("Canvas element not found");
                    return;
                }
                this.ctx = this.canvas.getContext("2d");
                this.resize();
                this.resizeHandler = this.resize.bind(this);
                this.mouseMoveHandler = (e) => this.updata_mouse(e.clientX, e.clientY);
                this.touchMoveHandler = (e) => {
                    e.preventDefault();
                    this.updata_mouse(e.touches[0].clientX, e.touches[0].clientY);
                };
                window.addEventListener("resize", this.resizeHandler);
                window.addEventListener("mousemove", this.mouseMoveHandler);
                window.addEventListener("touchmove", this.touchMoveHandler);
                this.animate();
                console.log('Background controller initialized');
            },
            destroy() {
                if (this.mouse.timer) {
                    clearTimeout(this.mouse.timer);
                }
                if (this.resizeHandler) {
                    window.removeEventListener("resize", this.resizeHandler);
                }
                if (this.mouseMoveHandler) {
                    window.removeEventListener("mousemove", this.mouseMoveHandler);
                }
                if (this.touchMoveHandler) {
                    window.removeEventListener("touchmove", this.touchMoveHandler);
                }
            },
            updata_mouse(x, y) {
                const dpr = window.devicePixelRatio || 1;
                this.mouse.x = x * dpr;
                this.mouse.y = y * dpr;
                this.mouse.if_moving = true;
                this.mouse.timer && clearTimeout(this.mouse.timer);
                this.mouse.timer = setTimeout(() => {
                    this.mouse.if_moving = false;
                }, 100);
            },
            resize() {
                const dpr = window.devicePixelRatio || 1;
                this.width = window.innerWidth;
                this.height = window.innerHeight;
                this.canvas.width = this.width * dpr;
                this.canvas.height = this.height * dpr;
                this.canvas.style.width = this.width + "px";
                this.canvas.style.height = this.height + "px";
                this.ctx.scale(dpr, dpr);
                this.create_points();
            },
            create_points() {
                this.points = [];
                const spacing = globalConfig.background.pointSpacing;
                this.line = Math.ceil(this.width / spacing);
                this.row = Math.ceil(this.height / spacing);
                const dpr = window.devicePixelRatio || 1;
                for (let i = 0; i <= this.row; i++) {
                    for (let j = 0; j <= this.line; j++) {
                        this.points.push({
                            x: j * spacing * dpr,
                            y: i * spacing * dpr,
                            opacity: globalConfig.background.opacity.default,
                            text: null,
                            text_time: 0,
                            targetOpacity: 0,
                            pulsePhase: Math.random() * Math.PI * 2
                        });
                    }
                }
            },
            animate() {
                const dpr = window.devicePixelRatio || 1;
                this.ctx.clearRect(0, 0, this.width * dpr, this.height * dpr);
                const time = Date.now() * 0.001;
                this.points.forEach((point) => {
                    const dx = point.x - this.mouse.x;
                    const dy = point.y - this.mouse.y;
                    const distance = mathUtils.distance(point.x, point.y, this.mouse.x, this.mouse.y);
                    let targetOpacity = globalConfig.background.opacity.default;
                    // 
                    if (distance < this.mouse.radius) {
                        const influence = 1 - (distance / this.mouse.radius);
                        targetOpacity = globalConfig.background.opacity.active * influence;
                    }
                    if (!this.mouse.if_moving) {
                        const pulse = Math.sin(time + point.pulsePhase) * 0.05;
                        targetOpacity += pulse;
                    }
                    // 
                    point.opacity = mathUtils.lerp(
                        point.opacity,
                        targetOpacity,
                        globalConfig.background.opacity.transition
                    );
                    // 
                    if (point.opacity > 0.01) {
                        const dpr = window.devicePixelRatio || 1;
                        this.ctx.fillStyle = globalConfig.background.colors.point.replace('1)', `${point.opacity})`);
                        const size = window.innerWidth <= 652 ? (2 + point.opacity * 2) * 20 : (2 + point.opacity * 2) * 2.5;
                        this.ctx.fillRect(
                            point.x / dpr - size / 2,
                            point.y / dpr - size / 2,
                            size,
                            size
                        );
                    }
                });
                requestAnimationFrame(() => this.animate());
            }
        };
        // 
        const particleController = {
            container: null,
            canvas: null,
            ctx: null,
            width: 0,
            height: 0,
            particles: {
                now: [],
                user: [],
                agent: []
            },
            spacing: 5,
            speed: 0.05,
            frame: 0,
            if_moveable: false,
            mouse: {
                x: 0,
                y: 0,
                r: 0,
                if_hovering: true,
                last_time: null,
                timer: null
            },
            async init() {
                this.container = document.querySelector(".welcome_canvas");
                if (!this.container) return;
                this.canvas = document.createElement("canvas");
                this.ctx = this.canvas.getContext("2d");
                this.container.appendChild(this.canvas);
                this.resize();
                this.bindEvents();
                await this.create_particles();
                this.move_particles();
                console.log('Particle controller initialized');
            },
            resize() {
                this.width = this.container.offsetWidth;
                this.height = this.container.offsetHeight;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
            },
            bindEvents() {
                window.addEventListener("resize", () => this.resize());
                this.container.addEventListener("mouseenter", () => {
                    this.mouse.if_hovering = true;
                    this.if_moveable = true;
                });
                this.container.addEventListener("mouseleave", () => {
                    this.mouse.if_hovering = false;
                    this.if_moveable = false;
                });
                this.container.addEventListener("mousemove", (e) => {
                    const rect = this.container.getBoundingClientRect();
                    this.mouse.x = (e.clientX - rect.left) / this.width;
                    this.mouse.y = (e.clientY - rect.top) / this.height;
                });
            },
            async create_particles() {
                // 
                for (let i = 0; i < globalConfig.particles.count.user; i++) {
                    this.particles.user.push({
                        x: Math.random(),
                        y: Math.random(),
                        originalX: Math.random(),
                        originalY: Math.random(),
                        vx: 0,
                        vy: 0,
                        life: 1,
                        size: Math.random() * 2 + 1,
                        color: `hsl(${Math.random() * 60 + 200}, 70%, 70%)`
                    });
                }
                // 
                for (let i = 0; i < globalConfig.particles.count.agent; i++) {
                    this.particles.agent.push({
                        x: (Math.random() - 0.5) * 2,
                        y: (Math.random() - 0.5) * 2,
                        phase: Math.random() * Math.PI * 2,
                        amplitude: Math.random() * 0.5 + 0.2,
                        frequency: Math.random() * 0.02 + 0.01
                    });
                }
                this.particles.now = [...this.particles.user];
            },
            move_particles() {
                if (!this.if_moveable) {
                    requestAnimationFrame(() => this.move_particles());
                    return;
                }
                this.frame++;
                this.ctx.clearRect(0, 0, this.width, this.height);
                this.update_explosion_particles();
                this.particles.now.forEach((particle, index) => {
                    if (particle.life !== undefined) return;
                    const agent = this.particles.agent[index % this.particles.agent.length];
                    let targetX = agent.x * this.width + this.width / 2;
                    let targetY = agent.y * this.height + this.height / 2;
                    let currentX = particle.x * this.width + this.width / 2;
                    let currentY = particle.y * this.height + this.height / 2;
                    // 
                    if (this.mouse.if_hovering) {
                        const mouseX = this.mouse.x * this.width;
                        const mouseY = this.mouse.y * this.height;
                        const dx = mouseX - currentX;
                        const dy = mouseY - currentY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 100) {
                            const force = (100 - distance) / 100;
                            targetX += dx * force * 0.5;
                            targetY += dy * force * 0.5;
                        }
                    }
                    // 
                    particle.x += (targetX / this.width - 0.5 - particle.x) * this.speed;
                    particle.y += (targetY / this.height - 0.5 - particle.y) * this.speed;
                    // 
                    this.ctx.fillStyle = particle.color || "rgba(255, 255, 255, 0.6)";
                    this.ctx.beginPath();
                    this.ctx.arc(currentX, currentY, particle.size || 1, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                requestAnimationFrame(() => this.move_particles());
            },
            create_explosion(x, y) {
                for (let i = 0; i < 20; i++) {
                    this.particles.now.push({
                        x: x / this.width,
                        y: y / this.height,
                        vx: (Math.random() - 0.5) * 0.1,
                        vy: (Math.random() - 0.5) * 0.1,
                        life: 1,
                        decay: 0.02
                    });
                }
            },
            update_explosion_particles() {
                this.particles.now = this.particles.now.filter(particle => {
                    if (particle.life !== undefined) {
                        particle.x += particle.vx;
                        particle.y += particle.vy;
                        particle.life -= particle.decay;
                        if (particle.life > 0) {
                            this.ctx.save();
                            this.ctx.globalAlpha = particle.life;
                            this.ctx.fillStyle = "rgba(244, 164, 67, 1)";
                            this.ctx.beginPath();
                            this.ctx.arc(
                                particle.x * this.width,
                                particle.y * this.height,
                                2, 0, Math.PI * 2
                            );
                            this.ctx.fill();
                            this.ctx.restore();
                            return true;
                        }
                    }
                    return particle.life === undefined;
                });
            },
            destroy() {
                if (this.mouse.timer) {
                    clearTimeout(this.mouse.timer);
                }
                if (this.canvas && this.canvas.parentNode) {
                    this.canvas.parentNode.removeChild(this.canvas);
                }
            }
        };
        // 
        const targetCursorController = {
            cursor: null,
            corners: null,
            spinAnimation: null,
            activeTarget: null,
            isAnimatingToTarget: false,
            resumeTimeout: null,
            currentTargetMove: null,
            currentLeaveHandler: null,
            // 
            config: {
                targetSelector: '.cursor-target',
                spinDuration: 2000, // 
                hideDefaultCursor: true,
                borderWidth: 3,
                cornerSize: 12,
                parallaxStrength: 0.00005
            },
            init() {
                this.cursor = document.getElementById('targetCursor');
                if (!this.cursor) {
                    console.error('Target cursor element not found');
                    return;
                }
                this.corners = this.cursor.querySelectorAll('.target-cursor-corner');
                if (this.config.hideDefaultCursor) {
                    document.body.classList.add('cursor-hidden');
                }
                // 
                this.cursor.style.left = (window.innerWidth / 2) + 'px';
                this.cursor.style.top = (window.innerHeight / 2) + 'px';
                this.cursor.style.opacity = '1';
                // 
                this.startSpinAnimation();
                // 
                this.bindEvents();
                console.log('Target cursor system initialized');
            },
            bindEvents() {
                // 
                this.mouseMoveHandler = (e) => this.moveCursor(e.clientX, e.clientY);
                window.addEventListener('mousemove', this.mouseMoveHandler);
                // 
                this.mouseOverHandler = (e) => this.handleMouseEnter(e);
                window.addEventListener('mouseover', this.mouseOverHandler, { passive: true });
            },
            moveCursor(x, y) {
                if (!this.cursor) return;
                this.cursor.style.left = x + 'px';
                this.cursor.style.top = y + 'px';
            },
            startSpinAnimation() {
                if (!this.cursor) return;
                if (this.spinAnimation) {
                    this.cursor.style.animation = '';
                }
                // 
                const keyframes = `
                    @keyframes targetCursorSpin {
                        from { transform: translate(-50%, -50%) rotate(0deg); }
                        to { transform: translate(-50%, -50%) rotate(360deg); }
                    }
                `;
                if (!document.getElementById('targetCursorKeyframes')) {
                    const style = document.createElement('style');
                    style.id = 'targetCursorKeyframes';
                    style.textContent = keyframes;
                    document.head.appendChild(style);
                }
                this.cursor.style.animation = `targetCursorSpin ${this.config.spinDuration}ms linear infinite`;
            },
            stopSpinAnimation() {
                if (this.cursor) {
                    this.cursor.style.animation = '';
                    this.cursor.style.transform = 'translate(-50%, -50%) rotate(0deg)';
                }
            },
            handleMouseEnter(e) {
                const directTarget = e.target;
                const allTargets = [];
                let current = directTarget;
                while (current && current !== document.body) {
                    if (current.matches && current.matches(this.config.targetSelector)) {
                        allTargets.push(current);
                    }
                    current = current.parentElement;
                }
                const target = allTargets[0] || null;
                if (!target || !this.cursor || !this.corners) return;
                if (this.activeTarget === target) return;
                if (this.activeTarget) {
                    this.cleanupTarget(this.activeTarget);
                }
                if (this.resumeTimeout) {
                    clearTimeout(this.resumeTimeout);
                    this.resumeTimeout = null;
                }
                this.activeTarget = target;
                this.stopSpinAnimation();
                this.updateCorners(target);
                this.bindTargetEvents(target);
            },
            updateCorners(target, mouseX, mouseY) {
                if (!this.corners || !this.cursor) return;
                const rect = target.getBoundingClientRect();
                const cursorRect = this.cursor.getBoundingClientRect();
                const cursorCenterX = cursorRect.left + cursorRect.width / 2;
                const cursorCenterY = cursorRect.top + cursorRect.height / 2;
                const corners = Array.from(this.corners);
                const { borderWidth, cornerSize, parallaxStrength } = this.config;
                // 
                const offsets = [
                    { // 
                        x: rect.left - cursorCenterX - borderWidth,
                        y: rect.top - cursorCenterY - borderWidth
                    },
                    { // 
                        x: rect.right - cursorCenterX + borderWidth - cornerSize,
                        y: rect.top - cursorCenterY - borderWidth
                    },
                    { // 
                        x: rect.right - cursorCenterX + borderWidth - cornerSize,
                        y: rect.bottom - cursorCenterY + borderWidth - cornerSize
                    },
                    { // 
                        x: rect.left - cursorCenterX - borderWidth,
                        y: rect.bottom - cursorCenterY + borderWidth - cornerSize
                    }
                ];
                if (mouseX !== undefined && mouseY !== undefined) {
                    const targetCenterX = rect.left + rect.width / 2;
                    const targetCenterY = rect.top + rect.height / 2;
                    const mouseOffsetX = (mouseX - targetCenterX) * parallaxStrength;
                    const mouseOffsetY = (mouseY - targetCenterY) * parallaxStrength;
                    offsets.forEach(offset => {
                        offset.x += mouseOffsetX;
                        offset.y += mouseOffsetY;
                    });
                }
                corners.forEach((corner, index) => {
                    corner.style.transition = 'transform 0.2s ease-out';
                    corner.style.transform = `translate(${offsets[index].x}px, ${offsets[index].y}px)`;
                });
            },
            bindTargetEvents(target) {
                let moveThrottle = null;
                this.currentTargetMove = (e) => {
                    if (moveThrottle || this.isAnimatingToTarget) return;
                    moveThrottle = requestAnimationFrame(() => {
                        this.updateCorners(target, e.clientX, e.clientY);
                        moveThrottle = null;
                    });
                };
                // 
                this.currentLeaveHandler = () => {
                    this.handleMouseLeave(target);
                };
                target.addEventListener('mousemove', this.currentTargetMove);
                target.addEventListener('mouseleave', this.currentLeaveHandler);
            },
            handleMouseLeave(target) {
                this.activeTarget = null;
                this.isAnimatingToTarget = false;
                if (this.corners) {
                    const corners = Array.from(this.corners);
                    const { cornerSize } = this.config;
                    const positions = [
                        { x: -cornerSize * 1.5, y: -cornerSize * 1.5 },
                        { x: cornerSize * 0.5, y: -cornerSize * 1.5 },
                        { x: cornerSize * 0.5, y: cornerSize * 0.5 },
                        { x: -cornerSize * 1.5, y: cornerSize * 0.5 }
                    ];
                    corners.forEach((corner, index) => {
                        corner.style.transition = 'transform 0.3s ease-out';
                        corner.style.transform = `translate(${positions[index].x}px, ${positions[index].y}px)`;
                    });
                }
                this.resumeTimeout = setTimeout(() => {
                    if (!this.activeTarget) {
                        this.startSpinAnimation();
                    }
                    this.resumeTimeout = null;
                }, 50);
                this.cleanupTarget(target);
            },
            cleanupTarget(target) {
                if (this.currentTargetMove) {
                    target.removeEventListener('mousemove', this.currentTargetMove);
                }
                if (this.currentLeaveHandler) {
                    target.removeEventListener('mouseleave', this.currentLeaveHandler);
                }
                this.currentTargetMove = null;
                this.currentLeaveHandler = null;
            },
            destroy() {
                if (this.mouseMoveHandler) {
                    window.removeEventListener('mousemove', this.mouseMoveHandler);
                }
                if (this.mouseOverHandler) {
                    window.removeEventListener('mouseover', this.mouseOverHandler);
                }
                if (this.activeTarget) {
                    this.cleanupTarget(this.activeTarget);
                }
                if (this.resumeTimeout) {
                    clearTimeout(this.resumeTimeout);
                    this.resumeTimeout = null;
                }
                document.body.classList.remove('cursor-hidden');
                if (this.cursor) {
                    this.cursor.style.opacity = '0';
                }
                const keyframeStyle = document.getElementById('targetCursorKeyframes');
                if (keyframeStyle) {
                    keyframeStyle.remove();
                }
                console.log('Target cursor system destroyed');
            }
        };
        // z-index
        const buttonZIndexController = {
            upButton: null,
            musicButton: null,
            originalZIndex: 100,
            lowZIndex: 10,
            activeModals: 0,
            init() {
                this.upButton = document.querySelector('.up');
                this.musicButton = document.querySelector('.music');
                window.addEventListener('resize', () => {
                    this.handleResize();
                });
                // z-index
                this.handleResize();
                console.log('Button z-index controller initialized');
            },
            handleResize() {
                if (this.activeModals === 0) {
                    const shouldApplyHighZIndex = window.innerWidth < 652;
                    if (this.upButton) {
                        if (shouldApplyHighZIndex) {
                            this.upButton.style.zIndex = this.originalZIndex;
                        } else {
                            this.upButton.style.zIndex = '';
                        }
                    }
                    if (this.musicButton) {
                        if (shouldApplyHighZIndex) {
                            this.musicButton.style.zIndex = this.originalZIndex;
                        } else {
                            this.musicButton.style.zIndex = '';
                        }
                    }
                }
            },
            lowerButtonsZIndex() {
                this.activeModals++;
                if (this.upButton) {
                    this.upButton.style.zIndex = this.lowZIndex;
                }
                if (this.musicButton) {
                    this.musicButton.style.zIndex = this.lowZIndex;
                }
                console.log('Buttons z-index lowered to', this.lowZIndex, '- Active modals:', this.activeModals);
            },
            restoreButtonsZIndex() {
                this.activeModals = Math.max(0, this.activeModals - 1);
                if (this.activeModals === 0) {
                    const shouldApplyHighZIndex = window.innerWidth < 652;
                    if (this.upButton) {
                        if (shouldApplyHighZIndex) {
                            this.upButton.style.zIndex = this.originalZIndex;
                        } else {
                            this.upButton.style.zIndex = '';
                        }
                    }
                    if (this.musicButton) {
                        if (shouldApplyHighZIndex) {
                            this.musicButton.style.zIndex = this.originalZIndex;
                        } else {
                            this.musicButton.style.zIndex = '';
                        }
                    }
                    console.log('Buttons z-index restored - width:', window.innerWidth, 'applied z-index:', shouldApplyHighZIndex ? this.originalZIndex : 'default');
                } else {
                    console.log('Buttons z-index not restored - still have', this.activeModals, 'active modals');
                }
            }
        };
        // 
        const linkModalController = {
            modal: null,
            content: null,
            urlElement: null,
            copyButton: null,
            currentUrl: '',
            originalButtonText: '',
            originalButtonColor: '#aeffc5',
            originalTextColor: '#1a1a1a',
            resetStyleTimer: null,
            init() {
                this.modal = document.getElementById('linkModal');
                this.content = this.modal.querySelector('.link-modal-content');
                this.urlElement = document.getElementById('linkModalUrl');
                this.copyButton = document.getElementById('linkModalCopy');
                this.originalButtonText = this.copyButton.textContent;
                this.originalButtonColor = window.getComputedStyle(this.copyButton).backgroundColor;
                this.originalTextColor = window.getComputedStyle(this.copyButton).color;
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });
                this.copyButton.addEventListener('click', () => {
                    this.copyToClipboard();
                });
                console.log('Link modal controller initialized');
            },
            show(url) {
                this.currentUrl = url;
                this.urlElement.textContent = url;
                this.resetButtonStyle();
                buttonZIndexController.lowerButtonsZIndex();
                // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                this.modal.classList.add('show');
                this.content.classList.remove('hide-animation');
                this.content.classList.add('show-animation');
            },
            hide() {
                this.resetButtonStyle();
                buttonZIndexController.restoreButtonsZIndex();
                this.content.classList.remove('show-animation');
                this.content.classList.add('hide-animation');
                setTimeout(() => {
                    this.modal.classList.remove('show');
                    this.content.classList.remove('hide-animation');
                }, 300);
            },
            resetButtonStyle() {
                if (this.resetStyleTimer) {
                    clearTimeout(this.resetStyleTimer);
                    this.resetStyleTimer = null;
                }
                this.copyButton.textContent = this.originalButtonText;
                this.copyButton.style.backgroundColor = this.originalButtonColor;
                this.copyButton.style.color = this.originalTextColor;
            },
            copyToClipboard() {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(this.currentUrl).then(() => {
                        this.showCopySuccess();
                    }).catch(() => {
                        this.fallbackCopy();
                    });
                } else {
                    this.fallbackCopy();
                }
            },
            fallbackCopy() {
                const textArea = document.createElement('textarea');
                textArea.value = this.currentUrl;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    this.showCopySuccess();
                } catch (err) {
                    console.error(':', err);
                    alert('');
                }
                document.body.removeChild(textArea);
            },
            showCopySuccess() {
                if (this.resetStyleTimer) {
                    clearTimeout(this.resetStyleTimer);
                }
                this.copyButton.textContent = '';
                this.copyButton.style.backgroundColor = '#aeffc5';
                this.copyButton.style.color = '#1a1a1a';
                setTimeout(() => {
                    this.hide();
                }, 1000);
                this.resetStyleTimer = setTimeout(() => {
                    this.resetButtonStyle();
                }, 3000);
            }
        };
        const inputModalController = {
            modal: null,
            content: null,
            inputElement: null,
            confirmButton: null,
            titleElement: null,
            currentValue: '',
            originalButtonText: '',
            resetStyleTimer: null,
            questionConfigs: {
                2: {
                    title: '',
                    placeholder: '...',
                    buttonText: ''
                },
                4: {
                    title: '',
                    placeholder: '...',
                    buttonText: ''
                },
                5: {
                    title: '',
                    placeholder: '...',
                    buttonText: ''
                },
                7: {
                    title: '',
                    placeholder: '...',
                    buttonText: ''
                }
            },
            init() {
                this.modal = document.getElementById('inputModal');
                this.content = this.modal.querySelector('.link-modal-content');
                this.inputElement = document.getElementById('inputModalText');
                this.confirmButton = document.getElementById('inputModalConfirm');
                this.titleElement = document.getElementById('inputModalTitle');
                this.originalButtonText = this.confirmButton.textContent;
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });
                this.confirmButton.addEventListener('click', () => {
                    this.confirm();
                });
                this.inputElement.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.confirm();
                    }
                });
                console.log('Input modal controller initialized');
            },
            show(questionNumber = null) {
                this.currentValue = '';
                this.inputElement.value = '';
                const currentQ = questionNumber || questionnaireController.currentQuestion;
                const config = this.questionConfigs[currentQ] || this.questionConfigs[2]; // 
                this.titleElement.textContent = config.title;
                this.inputElement.placeholder = config.placeholder;
                this.originalButtonText = config.buttonText;
                this.resetButtonStyle();
                buttonZIndexController.lowerButtonsZIndex();
                // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                this.modal.classList.add('show');
                this.content.classList.remove('hide-animation');
                this.content.classList.add('show-animation');
                setTimeout(() => {
                    this.inputElement.focus();
                }, 400);
            },
            hide() {
                this.resetButtonStyle();
                buttonZIndexController.restoreButtonsZIndex();
                this.content.classList.remove('show-animation');
                this.content.classList.add('hide-animation');
                setTimeout(() => {
                    this.modal.classList.remove('show');
                    this.content.classList.remove('hide-animation');
                }, 300);
            },
            resetButtonStyle() {
                if (this.resetStyleTimer) {
                    clearTimeout(this.resetStyleTimer);
                    this.resetStyleTimer = null;
                }
                this.confirmButton.textContent = this.originalButtonText;
                this.confirmButton.style.backgroundColor = '';
                this.confirmButton.style.color = '';
            },
            confirm() {
                const value = this.inputElement.value.trim();
                if (!value) {
                    this.inputElement.style.borderColor = '#ce0000';
                    setTimeout(() => {
                        this.inputElement.style.borderColor = '#4a3b32';
                    }, 1000);
                    return;
                }
                this.currentValue = value;
                const currentQ = questionnaireController.currentQuestion;
                if (currentQ >= 2 && currentQ <= 7) {
                    questionnaireController.userChoices[`q${currentQ}`] = value;
                    console.log(` q${currentQ}: ${value}`);
                }
                this.confirmButton.textContent = '';
                this.confirmButton.style.backgroundColor = '#aeffc5';
                this.confirmButton.style.color = '#1a1a1a';
                setTimeout(() => {
                    this.hide();
                    questionnaireController.nextQuestion();
                }, 400);
            }
        };
        const skipModalController = {
            modal: null,
            content: null,
            confirmButton: null,
            cancelButton: null,
            init() {
                this.modal = document.getElementById('skipModal');
                this.content = this.modal.querySelector('.skip-modal-content');
                this.confirmButton = document.getElementById('skipConfirm');
                this.cancelButton = document.getElementById('skipCancel');
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });
                this.confirmButton.addEventListener('click', () => {
                    this.confirm();
                });
                this.cancelButton.addEventListener('click', () => {
                    this.hide();
                });
                console.log('Skip modal controller initialized');
            },
            show() {
                buttonZIndexController.lowerButtonsZIndex();
                this.modal.classList.add('show');
                this.content.classList.remove('hide-animation');
                this.content.classList.add('show-animation');
            },
            hide() {
                buttonZIndexController.restoreButtonsZIndex();
                this.content.classList.remove('show-animation');
                this.content.classList.add('hide-animation');
                setTimeout(() => {
                    this.modal.classList.remove('show');
                    this.content.classList.remove('hide-animation');
                }, 300);
            },
            confirm() {
                this.hide();
                setTimeout(() => {
                    this.startEndAnimation();
                }, 300);
            },
            startEndAnimation() {
                document.body.classList.add('questionnaire-end');
                const currentQuestion = document.querySelector(`.question[q="${questionnaireController.currentQuestion}"]`);
                if (currentQuestion) {
                    currentQuestion.style.animation = 'questionUP 1s ease forwards';
                }
                const leftChoice = document.querySelector(`.choice[q="${questionnaireController.currentQuestion}"].left`);
                const rightChoice = document.querySelector(`.choice[q="${questionnaireController.currentQuestion}"].right`);
                if (leftChoice) {
                    leftChoice.style.animation = 'choiceLeftOut 1s ease forwards';
                }
                if (rightChoice) {
                    rightChoice.style.animation = 'choiceRightOut 1s ease forwards';
                }
                const progressNav = document.querySelector('.progress-nav');
                if (progressNav) {
                    progressNav.style.opacity = '0';
                }
                setTimeout(() => {
                    this.showFinalPage();
                }, 1000);
            },
            showFinalPage() {
                const finalPage = document.getElementById('finalPage');
                if (finalPage) {
                    finalPage.classList.add('show');
                }
            }
        };
        const returnModalController = {
            modal: null,
            content: null,
            confirmButton: null,
            cancelButton: null,
            init() {
                this.modal = document.getElementById('returnModal');
                this.content = this.modal.querySelector('.skip-modal-content');
                this.confirmButton = document.getElementById('returnConfirm');
                this.cancelButton = document.getElementById('returnCancel');
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });
                this.confirmButton.addEventListener('click', () => {
                    this.confirm();
                });
                this.cancelButton.addEventListener('click', () => {
                    this.hide();
                });
                console.log('Return modal controller initialized');
            },
            show() {
                buttonZIndexController.lowerButtonsZIndex();
                this.modal.classList.add('show');
                this.content.classList.remove('hide-animation');
                this.content.classList.add('show-animation');
            },
            hide() {
                buttonZIndexController.restoreButtonsZIndex();
                this.content.classList.remove('show-animation');
                this.content.classList.add('hide-animation');
                setTimeout(() => {
                    this.modal.classList.remove('show');
                    this.content.classList.remove('hide-animation');
                }, 300);
            },
            confirm() {
                this.hide();
                setTimeout(() => {
                    this.startReturnAnimation();
                }, 300);
            },
            startReturnAnimation() {
                const finalPage = document.getElementById('finalPage');
                const musicButton = document.querySelector('.music');
                if (finalPage) {
                    finalPage.style.transition = 'transform 1s ease';
                    finalPage.style.transform = 'translateX(100%)';
                }
                if (musicButton) {
                    musicButton.style.transition = 'transform 0.8s ease';
                    musicButton.style.transform = 'translateX(200px)';
                }
                setTimeout(() => {
                    finalPage.style.transition = 'none';
                    finalPage.classList.remove('show');
                    finalPage.style.transform = '';
                    setTimeout(() => {
                        finalPage.style.transition = '';
                    }, 50);
                    this.resetQuestionnaireState();
                    const questionEl = document.querySelector(`.question[q="1"]`);
                    if (questionEl) {
                        questionEl.style.display = 'block';
                        questionEl.style.transform = 'translateY(-100%)';
                        setTimeout(() => {
                            questionEl.style.animation = 'questionDOWN 0.55s ease forwards';
                        }, 50);
                    }
                    const choices = document.querySelectorAll('.choice[q="1"]');
                    choices.forEach(choice => {
                        choice.style.display = 'flex';
                        if (choice.classList.contains('left')) {
                            choice.style.transform = 'translateX(-120vw)';
                            choice.style.opacity = '0';
                            setTimeout(() => {
                                choice.style.animation = 'choiceLeftIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                            }, 50);
                        } else if (choice.classList.contains('right')) {
                            choice.style.transform = 'translateX(120vw)';
                            choice.style.opacity = '0';
                            setTimeout(() => {
                                choice.style.animation = 'choiceRightIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                            }, 50);
                        }
                    });
                    if (musicButton) {
                        setTimeout(() => {
                            document.body.classList.remove('final-page-exists');
                            musicButton.style.transition = 'transform 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                            musicButton.style.transform = 'translateX(0)';
                        }, 50);
                    }
                    const progressNav = document.querySelector('.progress-nav');
                    if (progressNav) {
                        progressNav.style.opacity = '1';
                    }
                    setTimeout(() => {
                        if (questionEl) {
                            questionEl.style.animation = '';
                            questionEl.style.transform = '';
                        }
                        choices.forEach(choice => {
                            choice.style.animation = '';
                            choice.style.transform = '';
                            choice.style.opacity = '';
                        });
                        if (musicButton) {
                            musicButton.style.transform = '';
                            musicButton.style.transition = '';
                        }
                    }, 600);
                }, 1000);
            },
            resetQuestionnaireState() {
                questionnaireController.currentQuestion = 1;
                for (let i = 1; i <= questionnaireController.maxQuestion; i++) {
                    const questionEl = document.querySelector(`.question[q="${i}"]`);
                    const choices = document.querySelectorAll(`.choice[q="${i}"]`);
                    if (questionEl) {
                        questionEl.style.display = i === 1 ? 'none' : 'none';
                        questionEl.style.animation = '';
                        questionEl.style.transform = '';
                    }
                    choices.forEach(choice => {
                        choice.style.display = i === 1 ? 'none' : 'none';
                        choice.classList.remove('selected');
                        choice.style.animation = '';
                        choice.style.transform = '';
                        choice.style.opacity = '';
                    });
                }
                questionnaireController.selectedChoice = null;
                questionnaireController.updateProgressNav();
                questionnaireController.updateUpButtonVisibility();
                document.body.classList.remove('questionnaire-end');
            }
        };
        const nameModalController = {
            modal: null,
            content: null,
            inputElement: null,
            confirmButton: null,
            cancelButton: null,
            init() {
                this.modal = document.getElementById('nameModal');
                this.content = this.modal.querySelector('.name-modal-content');
                this.inputElement = document.getElementById('nameInput');
                this.confirmButton = document.getElementById('nameConfirm');
                this.cancelButton = document.getElementById('nameCancel');
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });
                this.confirmButton.addEventListener('click', () => {
                    this.confirm();
                });
                this.cancelButton.addEventListener('click', () => {
                    this.hide();
                });
                this.inputElement.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.confirm();
                    }
                });
                console.log('Name modal controller initialized');
            },
            show() {
                this.inputElement.value = '';
                buttonZIndexController.lowerButtonsZIndex();
                this.modal.classList.add('show');
                this.content.classList.remove('hide-animation');
                this.content.classList.add('show-animation');
                setTimeout(() => {
                    this.inputElement.focus();
                }, 400);
            },
            hide() {
                buttonZIndexController.restoreButtonsZIndex();
                this.content.classList.remove('show-animation');
                this.content.classList.add('hide-animation');
                setTimeout(() => {
                    this.modal.classList.remove('show');
                    this.content.classList.remove('hide-animation');
                }, 300);
            },
            confirm() {
                const name = this.inputElement.value.trim();
                if (!name) {
                    this.inputElement.style.borderColor = '#ce0000';
                    setTimeout(() => {
                        this.inputElement.style.borderColor = '#4a3b32';
                    }, 1000);
                    return;
                }
                questionnaireController.userChoices.q8 = name;
                console.log(` q8: ${name}`);
                this.hide();
                this.startEndAnimation();
            },
            startEndAnimation() {
                document.body.classList.add('questionnaire-end');
                const currentQuestion = document.querySelector(`.question[q="${questionnaireController.currentQuestion}"]`);
                if (currentQuestion) {
                    currentQuestion.style.animation = 'questionUP 1s ease forwards';
                }
                const leftChoice = document.querySelector(`.choice[q="${questionnaireController.currentQuestion}"].left`);
                const rightChoice = document.querySelector(`.choice[q="${questionnaireController.currentQuestion}"].right`);
                if (leftChoice) {
                    leftChoice.style.animation = 'choiceLeftOut 1s ease forwards';
                }
                if (rightChoice) {
                    rightChoice.style.animation = 'choiceRightOut 1s ease forwards';
                }
                const progressNav = document.querySelector('.progress-nav');
                if (progressNav) {
                    progressNav.style.opacity = '0';
                }
                setTimeout(() => {
                    this.showFinalPage();
                }, 1000);
            },
            showFinalPage() {
                const finalPage = document.getElementById('finalPage');
                if (finalPage) {
                    finalPage.classList.add('show');
                }
            }
        };
        const gameInfoController = {
            modal: null,
            content: null,
            infoContent: null,
            copyButton: null,
            closeButton: null,
            init() {
                this.modal = document.getElementById('gameInfoModal');
                this.content = this.modal.querySelector('.name-modal-content');
                this.infoContent = document.getElementById('gameInfoContent');
                this.copyButton = document.getElementById('gameInfoCopy');
                this.closeButton = document.getElementById('gameInfoClose');
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });
                this.copyButton.addEventListener('click', () => {
                    this.copyInfo();
                });
                this.closeButton.addEventListener('click', () => {
                    this.hide();
                });
                console.log('Game info controller initialized');
            },
            show() {
                const gameInfo = this.generateGameInfo();
                this.infoContent.textContent = gameInfo;
                buttonZIndexController.lowerButtonsZIndex();
                this.modal.classList.add('show');
                this.content.classList.remove('hide-animation');
                this.content.classList.add('show-animation');
            },
            hide() {
                buttonZIndexController.restoreButtonsZIndex();
                this.content.classList.remove('show-animation');
                this.content.classList.add('hide-animation');
                setTimeout(() => {
                    this.modal.classList.remove('show');
                    this.content.classList.remove('hide-animation');
                }, 300);
            },
            generateGameInfo() {
                const choices = questionnaireController.userChoices;
                // 
                let basicStats = '21'; // 
                if (choices.q3 === '') basicStats = '45';
                else if (choices.q3 === '') basicStats = '30';
                else if (choices.q3 === '') basicStats = '21';
                else if (choices.q3 === '') basicStats = '12';
                // 
                let guideName = 'none'; // 
                if (choices.q7 === '') guideName = '';
                else if (choices.q7 === '') guideName = '';
                else if (choices.q7 === '') guideName = 'none';
                else if (choices.q7) guideName = choices.q7; 
                const gameInfo = `<SET></SET>
<Uname>${choices.q8 || ''}</Uname>
<Ugend>${choices.q2 || ''}</Ugend>
<point>${basicStats}</point>
<Ngend>${choices.q4 || ''}</Ngend>
<Dstyle>${choices.q5 || ''}</Dstyle>
<Tatt>${choices.q6 || ''}</Tatt>
<guide>${guideName}</guide>`;
                return gameInfo;
            },
            async copyInfo() {
                const gameInfo = this.infoContent.textContent;
                try {
                    if (navigator.clipboard && window.isSecureContext) {
                        await navigator.clipboard.writeText(gameInfo);
                        this.showCopySuccess();
                    } else {
                        this.fallbackCopyTextToClipboard(gameInfo);
                    }
                } catch (err) {
                    console.error(':', err);
                    this.fallbackCopyTextToClipboard(gameInfo);
                }
            },
            fallbackCopyTextToClipboard(text) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-999999px";
                textArea.style.top = "-999999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        this.showCopySuccess();
                    } else {
                        this.showCopyError();
                    }
                } catch (err) {
                    console.error(':', err);
                    this.showCopyError();
                }
                document.body.removeChild(textArea);
            },
            showCopySuccess() {
                const originalText = this.copyButton.textContent;
                this.copyButton.textContent = '';
                this.copyButton.style.backgroundColor = '#aeffc5';
                this.copyButton.style.color = '#1a1a1a';
                setTimeout(() => {
                    this.copyButton.textContent = originalText;
                    this.copyButton.style.backgroundColor = '';
                    this.copyButton.style.color = '';
                }, 2000);
            },
            showCopyError() {
                const originalText = this.copyButton.textContent;
                this.copyButton.textContent = '';
                this.copyButton.style.backgroundColor = '#ce0000';
                this.copyButton.style.color = '#ffffff';
                setTimeout(() => {
                    this.copyButton.textContent = originalText;
                    this.copyButton.style.backgroundColor = '';
                    this.copyButton.style.color = '';
                }, 2000);
            }
        };
        const resetModalController = {
            modal: null,
            content: null,
            confirmButton: null,
            cancelButton: null,
            init() {
                this.modal = document.getElementById('resetModal');
                this.content = this.modal.querySelector('.skip-modal-content');
                this.confirmButton = document.getElementById('resetConfirm');
                this.cancelButton = document.getElementById('resetCancel');
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.hide();
                    }
                });
                this.confirmButton.addEventListener('click', () => {
                    this.confirm();
                });
                this.cancelButton.addEventListener('click', () => {
                    this.hide();
                });
                console.log('Reset modal controller initialized');
            },
            show() {
                buttonZIndexController.lowerButtonsZIndex();
                this.modal.classList.add('show');
                this.content.classList.remove('hide-animation');
                this.content.classList.add('show-animation');
            },
            hide() {
                buttonZIndexController.restoreButtonsZIndex();
                this.content.classList.remove('show-animation');
                this.content.classList.add('hide-animation');
                setTimeout(() => {
                    this.modal.classList.remove('show');
                    this.content.classList.remove('hide-animation');
                }, 300);
            },
            confirm() {
                this.hide();
                this.playUpButtonRightOutAnimation();
                setTimeout(() => {
                    this.startResetAnimation();
                }, 300);
            },
            playUpButtonRightOutAnimation() {
                const upButton = document.querySelector('.up');
                if (upButton) {
                    upButton.style.animation = 'upButtonRightOut 0.8s ease forwards';
                    console.log('rightok');
                }
            },
            resetUpButtonState() {
                const upButton = document.querySelector('.up');
                if (upButton) {
                    upButton.style.animation = '';
                    upButton.style.transform = '';
                    upButton.style.opacity = '';
                    console.log('Upok');
                }
            },
            startResetAnimation() {
                this.clearUserChoices();
                questionnaireController.selectedChoice = null;
                const currentQuestion = document.querySelector(`.question[q="${questionnaireController.currentQuestion}"]`);
                const currentChoices = document.querySelectorAll(`.choice[q="${questionnaireController.currentQuestion}"]`);
                if (currentQuestion) {
                    currentQuestion.style.animation = 'questionUP 0.6s ease forwards';
                }
                currentChoices.forEach(choice => {
                    if (choice.classList.contains('left')) {
                        choice.style.animation = 'choiceLeftOut 0.6s ease forwards';
                    } else if (choice.classList.contains('right')) {
                        choice.style.animation = 'choiceRightOut 0.6s ease forwards';
                    }
                });
                setTimeout(() => {
                    this.switchToQuestion1();
                }, 600);
            },
            clearUserChoices() {
                Object.keys(questionnaireController.userChoices).forEach(key => {
                    questionnaireController.userChoices[key] = '';
                });
                console.log('ok');
            },
            switchToQuestion1() {
                const currentQuestion = document.querySelector(`.question[q="${questionnaireController.currentQuestion}"]`);
                const currentChoices = document.querySelectorAll(`.choice[q="${questionnaireController.currentQuestion}"]`);
                if (currentQuestion) {
                    currentQuestion.style.display = 'none';
                    currentQuestion.style.animation = '';
                    currentQuestion.style.transform = '';
                }
                currentChoices.forEach(choice => {
                    choice.style.display = 'none';
                    choice.style.animation = '';
                    choice.style.transform = '';
                    choice.style.opacity = '';
                    choice.classList.remove('selected');
                });
                questionnaireController.currentQuestion = 1;
                questionnaireController.selectedChoice = null;
                const q1Question = document.querySelector('.question[q="1"]');
                const q1Choices = document.querySelectorAll('.choice[q="1"]');
                if (q1Question) {
                    q1Question.style.display = 'block';
                    q1Question.style.transform = 'translateY(-100%)';
                }
                q1Choices.forEach(choice => {
                    choice.style.display = 'flex';
                    if (choice.classList.contains('left')) {
                        choice.style.transform = 'translateX(-120vw)';
                        choice.style.opacity = '0';
                    } else if (choice.classList.contains('right')) {
                        choice.style.transform = 'translateX(120vw)';
                        choice.style.opacity = '0';
                    }
                });
                setTimeout(() => {
                    if (q1Question) {
                        q1Question.style.animation = 'questionDOWN 0.55s ease forwards';
                    }
                    q1Choices.forEach(choice => {
                        if (choice.classList.contains('left')) {
                            choice.style.animation = 'choiceLeftIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        } else if (choice.classList.contains('right')) {
                            choice.style.animation = 'choiceRightIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        }
                    });
                    setTimeout(() => {
                        if (q1Question) {
                            q1Question.style.animation = '';
                            q1Question.style.transform = '';
                        }
                        q1Choices.forEach(choice => {
                            choice.style.animation = '';
                            choice.style.transform = '';
                            choice.style.opacity = '';
                        });
                        questionnaireController.updateProgressNav();
                        this.resetUpButtonState();
                        questionnaireController.updateUpButtonVisibility();
                    }, 600);
                }, 50);
            }
        };
        const questionnaireController = {
            currentQuestion: 1,
            maxQuestion: 8,
            isAnimating: false,
            selectedChoice: null,
            userChoices: {
                q2: '', // 
                q3: '', // 
                q4: '', // NPC
                q5: '', // 
                q6: '', // 
                q7: '', // 
                q8: ''  // 
            },
            // 
            stylePool: [
                "", "", "", "",
                "", "", "", "",
                "", "", "", ""
            ],
            currentStyles: [], 
            init() {
                this.bindChoiceEvents();
                this.bindUpButtonEvent();
                this.initProgressNav();
                this.showCurrentQuestion();
                this.currentStyles = [];
                this.generateRandomStyles();
                console.log('Questionnaire controller initialized');
            },
            initProgressNav() {
                const progressSegments = document.getElementById('progressSegments');
                if (!progressSegments) return;
                progressSegments.innerHTML = '';
                for (let i = 1; i <= this.maxQuestion; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'progress-dot';
                    dot.setAttribute('data-question', i);
                    progressSegments.appendChild(dot);
                }
                this.updateProgressNav();
            },
            updateProgressNav() {
                const progressLine = document.getElementById('progressLine');
                const progressDots = document.querySelectorAll('.progress-dot');
                if (!progressLine || !progressDots.length) return;
                const progress = ((this.currentQuestion - 1) / (this.maxQuestion - 1)) * 100;
                progressLine.style.width = `${progress}%`;
                progressDots.forEach((dot, index) => {
                    const questionNum = index + 1;
                    dot.classList.remove('active', 'completed');
                    if (questionNum < this.currentQuestion) {
                        dot.classList.add('completed');
                    } else if (questionNum === this.currentQuestion) {
                        dot.classList.add('active');
                    }
                });
            },
            generateRandomStyles() {
                let newStyles = [];
                let availableStyles = [...this.stylePool];
                if (this.currentStyles.length > 0) {
                    availableStyles = availableStyles.filter(style =>
                        !this.currentStyles.includes(style)
                    );
                }
                if (availableStyles.length < 2) {
                    availableStyles = [...this.stylePool];
                }
                const shuffled = availableStyles.sort(() => 0.5 - Math.random());
                newStyles = shuffled.slice(0, 2);
                while (newStyles[0] === newStyles[1] && availableStyles.length > 1) {
                    const reshuffled = availableStyles.sort(() => 0.5 - Math.random());
                    newStyles = reshuffled.slice(0, 2);
                }
                this.currentStyles = newStyles;
                const q5Choices = document.querySelectorAll('.choice[q="5"]');
                if (q5Choices.length >= 2) {
                    q5Choices[0].querySelector('p').textContent = this.currentStyles[0];
                    q5Choices[1].querySelector('p').textContent = this.currentStyles[1];
                }
            },
            refreshStyles() {
                if (this.isAnimating) return;
                this.isAnimating = true;
                const q5Choices = document.querySelectorAll('.choice[q="5"]');
                const leftChoice = q5Choices[0];
                const rightChoice = q5Choices[1];
                if (!leftChoice || !rightChoice) {
                    this.isAnimating = false;
                    return;
                }
                leftChoice.style.animation = 'choiceLeftOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                rightChoice.style.animation = 'choiceRightOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                setTimeout(() => {
                    this.generateRandomStyles();
                    leftChoice.style.transform = 'translateX(-120vw)';
                    leftChoice.style.opacity = '0';
                    rightChoice.style.transform = 'translateX(120vw)';
                    rightChoice.style.opacity = '0';
                    setTimeout(() => {
                        leftChoice.style.animation = 'choiceLeftIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        rightChoice.style.animation = 'choiceRightIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        setTimeout(() => {
                            leftChoice.style.animation = '';
                            leftChoice.style.transform = '';
                            leftChoice.style.opacity = '';
                            rightChoice.style.animation = '';
                            rightChoice.style.transform = '';
                            rightChoice.style.opacity = '';
                            this.isAnimating = false;
                        }, 450);
                    }, 50);
                }, 450);
            },
            isMobile() {
                return window.innerWidth <= 652;
            },
            bindChoiceEvents() {
                document.addEventListener('click', (e) => {
                    const choice = e.target.closest('.choice');
                    if (!choice || this.isAnimating) return;
                    const questionNum = parseInt(choice.getAttribute('q'));
                    const action = choice.getAttribute('action');
                    if (questionNum !== this.currentQuestion) return;
                    if (this.isMobile()) {
                        if (this.selectedChoice === choice) {
                            this.executeAction(action, choice);
                            this.clearSelection();
                        } else {
                            this.selectChoice(choice);
                        }
                    } else {
                        this.executeAction(action, choice);
                    }
                });
            },
            bindUpButtonEvent() {
                const upButton = document.querySelector('.up');
                if (upButton) {
                    upButton.addEventListener('click', () => {
                        if (!this.isAnimating) {
                            this.previousQuestion();
                        }
                    });
                }
            },
            selectChoice(choice) {
                this.clearSelection();
                choice.classList.add('mobile-flash');
                setTimeout(() => {
                    choice.classList.remove('mobile-flash');
                    choice.classList.add('selected');
                }, 200);
                this.selectedChoice = choice;
            },
            clearSelection() {
                if (this.selectedChoice) {
                    this.selectedChoice.classList.remove('selected');
                    this.selectedChoice = null;
                }
                const currentChoices = document.querySelectorAll(`.choice[q="${this.currentQuestion}"]`);
                currentChoices.forEach(choice => {
                    choice.classList.remove('selected');
                });
            },
            executeAction(action, choiceElement) {
                if (action === 'next' && choiceElement && this.currentQuestion >= 2 && this.currentQuestion <= 7) {
                    const choiceText = choiceElement.querySelector('p').textContent.trim();
                    this.userChoices[`q${this.currentQuestion}`] = choiceText;
                    console.log(` q${this.currentQuestion}: ${choiceText}`);
                }
                if (action === 'link') {
                    const url = 'https://aify.pages.dev/';
                    if (window.innerWidth < 652) {
                        linkModalController.show(url);
                    } else {
                        window.open(url, '_blank');
                    }
                } else if (action === 'input') {
                    inputModalController.show(this.currentQuestion);
                } else if (action === 'next') {
                    if (this.currentQuestion === 5 && choiceElement && choiceElement.querySelector('p').textContent === '') {
                        this.refreshStyles();
                    } else {
                        this.nextQuestion();
                    }
                } else if (action === 'skip') {
                    skipModalController.show();
                } else if (action === 'start') {
                    nameModalController.show();
                } else if (action === 'restart') {
                    resetModalController.show();
                }
            },
            showCurrentQuestion() {
                const currentQuestionEl = document.querySelector(`.question[q="${this.currentQuestion}"]`);
                if (currentQuestionEl) {
                    currentQuestionEl.style.display = 'block';
                }
                const currentChoices = document.querySelectorAll(`.choice[q="${this.currentQuestion}"]`);
                currentChoices.forEach(choice => {
                    choice.style.display = 'flex';
                });
                if (this.currentQuestion === 5) {
                    if (this.currentStyles.length === 0) {
                        this.generateRandomStyles();
                    }
                }
                this.updateUpButtonVisibility();
            },
            updateUpButtonVisibility() {
                const upButton = document.querySelector('.up');
                if (upButton) {
                    if (this.currentQuestion > 1) {
                        upButton.classList.add('show');
                    } else {
                        upButton.classList.remove('show');
                    }
                }
            },
            hideCurrentQuestion() {
                const currentChoices = document.querySelectorAll(`.choice[q="${this.currentQuestion}"]`);
                currentChoices.forEach(choice => {
                    choice.style.display = 'none';
                });
            },
            nextQuestion() {
                if (this.currentQuestion >= this.maxQuestion || this.isAnimating) return;
                this.clearSelection();
                this.isAnimating = true;
                const currentQuestionEl = document.querySelector(`.question[q="${this.currentQuestion}"]`);
                const nextQuestionEl = document.querySelector(`.question[q="${this.currentQuestion + 1}"]`);
                if (!currentQuestionEl || !nextQuestionEl) {
                    this.isAnimating = false;
                    return;
                }
                const currentChoices = document.querySelectorAll(`.choice[q="${this.currentQuestion}"]`);
                const upButton = document.querySelector('.up');
                const musicButton = document.querySelector('.music');
                currentChoices.forEach(choice => {
                    if (choice.classList.contains('left')) {
                        choice.style.animation = 'choiceLeftOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                    } else if (choice.classList.contains('right')) {
                        choice.style.animation = 'choiceRightOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                    }
                });
                if (upButton && upButton.classList.contains('show')) {
                    upButton.style.animation = 'choiceLeftOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                }
                if (musicButton) {
                    musicButton.style.animation = 'choiceRightOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                }
                currentQuestionEl.style.animation = 'questionUP 0.4s ease forwards';
                setTimeout(() => {
                    currentQuestionEl.style.display = 'none';
                    currentQuestionEl.style.animation = '';
                    currentQuestionEl.style.transform = '';
                    currentChoices.forEach(choice => {
                        choice.style.display = 'none';
                        choice.style.animation = '';
                        choice.style.transform = '';
                    });
                    this.currentQuestion++;
                    nextQuestionEl.style.display = 'block';
                    nextQuestionEl.style.transform = 'translateY(-100%)';
                    const nextChoices = document.querySelectorAll(`.choice[q="${this.currentQuestion}"]`);
                    nextChoices.forEach(choice => {
                        choice.style.display = 'flex';
                        if (choice.classList.contains('left')) {
                            choice.style.transform = 'translateX(-120vw)';
                            choice.style.opacity = '0';
                        } else if (choice.classList.contains('right')) {
                            choice.style.transform = 'translateX(120vw)';
                            choice.style.opacity = '0';
                        }
                    });
                    setTimeout(() => {
                        nextQuestionEl.style.animation = 'questionDOWN 0.55s ease forwards';
                        nextChoices.forEach(choice => {
                            if (choice.classList.contains('left')) {
                                choice.style.animation = 'choiceLeftIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                            } else if (choice.classList.contains('right')) {
                                choice.style.animation = 'choiceRightIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                            }
                        });
                        if (upButton && this.currentQuestion > 1) {
                            upButton.style.transform = 'translateX(-120vw)';
                            upButton.style.opacity = '0';
                            upButton.style.animation = 'choiceLeftIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        }
                        if (musicButton) {
                            musicButton.style.transform = 'translateX(120vw)';
                            musicButton.style.opacity = '0';
                            musicButton.style.animation = 'choiceRightIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        }
                        setTimeout(() => {
                            nextQuestionEl.style.animation = '';
                            nextQuestionEl.style.transform = '';
                            nextChoices.forEach(choice => {
                                choice.style.animation = '';
                                choice.style.transform = '';
                                choice.style.opacity = '';
                            });
                            if (upButton) {
                                upButton.style.animation = '';
                                upButton.style.transform = '';
                                upButton.style.opacity = '';
                            }
                            if (musicButton) {
                                musicButton.style.animation = '';
                                musicButton.style.transform = '';
                                musicButton.style.opacity = '';
                            }
                            this.updateUpButtonVisibility();
                            this.updateProgressNav();
                            masonryController.updateMusicButtonStyle();
                            this.isAnimating = false;
                        }, 600);
                    }, 50);
                }, 600);
            },
            previousQuestion() {
                if (this.currentQuestion <= 1 || this.isAnimating) return;
                this.clearSelection();
                this.isAnimating = true;
                const currentQuestionEl = document.querySelector(`.question[q="${this.currentQuestion}"]`);
                const prevQuestionEl = document.querySelector(`.question[q="${this.currentQuestion - 1}"]`);
                if (!currentQuestionEl || !prevQuestionEl) {
                    this.isAnimating = false;
                    return;
                }
                const currentChoices = document.querySelectorAll(`.choice[q="${this.currentQuestion}"]`);
                const upButton = document.querySelector('.up');
                const musicButton = document.querySelector('.music');
                currentChoices.forEach(choice => {
                    if (choice.classList.contains('left')) {
                        choice.style.animation = 'choiceLeftOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                    } else if (choice.classList.contains('right')) {
                        choice.style.animation = 'choiceRightOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                    }
                });
                if (upButton && upButton.classList.contains('show')) {
                    upButton.style.animation = 'choiceLeftOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                }
                if (musicButton) {
                    musicButton.style.animation = 'choiceRightOut 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards';
                }
                currentQuestionEl.style.animation = 'questionUP 0.4s ease forwards';
                setTimeout(() => {
                    currentQuestionEl.style.display = 'none';
                    currentQuestionEl.style.animation = '';
                    currentQuestionEl.style.transform = '';
                    currentChoices.forEach(choice => {
                        choice.style.display = 'none';
                        choice.style.animation = '';
                        choice.style.transform = '';
                    });
                    this.currentQuestion--;
                    prevQuestionEl.style.display = 'block';
                    prevQuestionEl.style.transform = 'translateY(-100%)';
                    const prevChoices = document.querySelectorAll(`.choice[q="${this.currentQuestion}"]`);
                    prevChoices.forEach(choice => {
                        choice.style.display = 'flex';
                        if (choice.classList.contains('left')) {
                            choice.style.transform = 'translateX(-120vw)';
                            choice.style.opacity = '0';
                        } else if (choice.classList.contains('right')) {
                            choice.style.transform = 'translateX(120vw)';
                            choice.style.opacity = '0';
                        }
                    });
                    setTimeout(() => {
                        prevQuestionEl.style.animation = 'questionDOWN 0.55s ease forwards';
                        prevChoices.forEach(choice => {
                            if (choice.classList.contains('left')) {
                                choice.style.animation = 'choiceLeftIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                            } else if (choice.classList.contains('right')) {
                                choice.style.animation = 'choiceRightIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                            }
                        });
                        if (upButton && this.currentQuestion > 1) {
                            upButton.style.transform = 'translateX(-120vw)';
                            upButton.style.opacity = '0';
                            upButton.style.animation = 'choiceLeftIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        }
                        if (musicButton) {
                            musicButton.style.transform = 'translateX(120vw)';
                            musicButton.style.opacity = '0';
                            musicButton.style.animation = 'choiceRightIn 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                        }
                        setTimeout(() => {
                            prevQuestionEl.style.animation = '';
                            prevQuestionEl.style.transform = '';
                            prevChoices.forEach(choice => {
                                choice.style.animation = '';
                                choice.style.transform = '';
                                choice.style.opacity = '';
                            });
                            if (upButton) {
                                upButton.style.animation = '';
                                upButton.style.transform = '';
                                upButton.style.opacity = '';
                            }
                            if (musicButton) {
                                musicButton.style.animation = '';
                                musicButton.style.transform = '';
                                musicButton.style.opacity = '';
                            }
                            this.updateUpButtonVisibility();
                            this.updateProgressNav();
                            masonryController.updateMusicButtonStyle();
                            this.isAnimating = false;
                        }, 600);
                    }, 50);
                }, 600);
            },
            restartQuestionnaire() {
                if (this.isAnimating) return;
                this.clearSelection();
                for (let i = 1; i <= this.maxQuestion; i++) {
                    const questionEl = document.querySelector(`.question[q="${i}"]`);
                    const choices = document.querySelectorAll(`.choice[q="${i}"]`);
                    if (questionEl) {
                        questionEl.style.display = i === 1 ? 'block' : 'none';
                        questionEl.style.animation = '';
                        questionEl.style.transform = '';
                    }
                    choices.forEach(choice => {
                        choice.style.display = i === 1 ? 'flex' : 'none';
                        choice.classList.remove('selected');
                        choice.style.animation = '';
                        choice.style.transform = '';
                        choice.style.opacity = '';
                    });
                }
                this.currentQuestion = 1;
                this.updateUpButtonVisibility();
                this.updateProgressNav();
            }
        };
        const loadingController = {
            init() {
                setTimeout(() => {
                    this.startFinaleAnimation();
                }, 2500);
                setTimeout(() => {
                    this.startLineExpansion();
                }, 3700);
                setTimeout(() => {
                    this.startSplitAnimation();
                }, 4100);
            },
            startFinaleAnimation() {
                const loader = document.querySelector('.loader');
                if (loader) {
                    loader.classList.add('finale');
                }
            },
            startLineExpansion() {
                const loadingOverlay = document.getElementById('loadingOverlay');
                const lineExpansionOverlay = document.getElementById('lineExpansionOverlay');
                const whiteLine = document.getElementById('whiteLine');
                loadingOverlay.style.display = 'none';
                lineExpansionOverlay.style.display = 'block';
                if (whiteLine) {
                    whiteLine.classList.add('expand');
                }
            },
            startSplitAnimation() {
                const lineExpansionOverlay = document.getElementById('lineExpansionOverlay');
                const whiteLine = document.getElementById('whiteLine');
                const loadingOverlayTop = document.getElementById('loadingOverlayTop');
                const loadingOverlayBottom = document.getElementById('loadingOverlayBottom');
                lineExpansionOverlay.style.display = 'none';
                if (whiteLine) {
                    whiteLine.style.display = 'none';
                }
                loadingOverlayTop.style.display = 'block';
                loadingOverlayBottom.style.display = 'block';
                setTimeout(() => {
                    loadingOverlayTop.classList.add('slide-up');
                    loadingOverlayBottom.classList.add('slide-down');
                    setTimeout(() => {
                        loadingOverlayTop.style.display = 'none';
                        loadingOverlayBottom.style.display = 'none';
                        if (typeof musicController !== 'undefined') {
                            musicController.onSplitAnimationComplete();
                        }
                    }, 620);
                }, 50);
            }
        };
        const musicController = {
            audio: null,
            musicButton: null,
            isPlaying: false,
            isMuted: false,
            userMuted: false,
            musicUrl: 'http://music.163.com/song/media/outer/url?id=1809692124.mp3',
            isPreloaded: false,
            shouldAutoPlay: false,
            init() {
                this.musicButton = document.querySelector('.music');
                if (!this.musicButton) {
                    console.error('Music button not found');
                    return;
                }
                this.preloadMusic();
                this.musicButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.toggleMusic();
                });
                this.musicButton.classList.remove('muted');
                this.enableAutoPlayOnInteraction();
                console.log('Music controller initialized');
            },
            enableAutoPlayOnInteraction() {
                const enableAutoPlay = (event) => {
                    if (event.type === 'keydown' &&
                        (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA')) {
                        return;
                    }
                    console.log('Valid user interaction detected, enabling auto-play');
                    if (this.shouldAutoPlay && !this.isPlaying && this.audio) {
                        this.startAutoPlay();
                    }
                    document.removeEventListener('click', enableAutoPlay);
                    document.removeEventListener('keydown', enableAutoPlay);
                    document.removeEventListener('touchstart', enableAutoPlay);
                };
                document.addEventListener('click', enableAutoPlay);
                document.addEventListener('keydown', enableAutoPlay);
                document.addEventListener('touchstart', enableAutoPlay);
            },
            preloadMusic() {
                this.audio = new Audio();
                this.audio.preload = 'auto';
                this.audio.loop = true;
                this.audio.volume = 0.5;
                this.audio.src = this.musicUrl;
                this.audio.addEventListener('canplaythrough', () => {
                    console.log('Music preloaded successfully');
                    this.isPreloaded = true;
                    if (this.shouldAutoPlay && !this.isPlaying) {
                        console.log('Music preloaded and animation complete, starting playback');
                        this.startAutoPlay();
                    }
                });
                this.audio.addEventListener('loadeddata', () => {
                    console.log('Music data loaded');
                    if (this.shouldAutoPlay && !this.isPlaying && !this.isPreloaded) {
                        console.log('Attempting early playback with loaded data');
                        this.startAutoPlay();
                    }
                });
                this.audio.addEventListener('play', () => {
                    console.log('Audio play event triggered');
                    this.isPlaying = true;
                    this.isMuted = false;
                    this.musicButton.classList.remove('muted');
                });
                this.audio.addEventListener('pause', () => {
                    console.log('Audio pause event triggered');
                    this.isPlaying = false;
                    if (this.shouldAutoPlay && !this.isMuted) {
                        console.log('Auto-play pause detected, keeping play state appearance');
                    } else {
                        this.isMuted = true;
                        this.musicButton.classList.add('muted');
                    }
                });
                this.audio.addEventListener('error', (e) => {
                    console.error('Music loading failed:', e);
                    this.isPreloaded = false;
                });
                this.audio.load();
            },
            onSplitAnimationComplete() {
                console.log('Split animation completed, checking if should auto-play');
                this.shouldAutoPlay = true;
                if (!this.userMuted) {
                    this.musicButton.classList.remove('muted');
                    this.isMuted = false;
                    this.startAutoPlay();
                    if (!this.isPreloaded) {
                        console.log('Music not fully preloaded, will try again when ready');
                    }
                } else {
                    console.log('User has muted music, respecting user preference');
                }
            },
            startAutoPlay() {
                if (this.audio && !this.isPlaying) {
                    console.log('Attempting to start music auto-play...');
                    this.audio.currentTime = 0;
                    const playPromise = this.audio.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('Music started automatically after loading');
                            this.isPlaying = true;
                            this.isMuted = false;
                            this.musicButton.classList.remove('muted');
                        }).catch(error => {
                            console.log('Auto-play blocked by browser:', error.message);
                            this.isPlaying = false;
                            this.isMuted = false;
                            this.musicButton.classList.remove('muted');
                            console.log('Button forced to play state despite auto-play block');
                        });
                    }
                } else if (!this.audio) {
                    console.error('Audio object not initialized');
                } else if (this.isPlaying) {
                    console.log('Music is already playing');
                }
            },
            toggleMusic() {
                this.musicButton.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.musicButton.style.transform = '';
                }, 100);
                console.log('Toggle music - Current state:', { isPlaying: this.isPlaying, isMuted: this.isMuted, userMuted: this.userMuted });
                if (this.isPlaying) {
                    this.pauseMusic();
                    this.userMuted = true;
                } else {
                    this.playMusic();
                    this.userMuted = false;
                }
            },
            playMusic() {
                if (this.audio) {
                    this.audio.currentTime = 0;
                    this.musicButton.classList.remove('muted');
                    this.audio.play().then(() => {
                        this.isPlaying = true;
                        this.isMuted = false;
                        console.log('Music started playing from beginning');
                    }).catch(error => {
                        console.error('Failed to play music:', error);
                        setTimeout(() => {
                            this.showMutedState();
                        }, 100);
                    });
                }
            },
            pauseMusic() {
                if (this.audio) {
                    this.audio.pause();
                    this.isPlaying = false;
                    this.isMuted = true;
                    setTimeout(() => {
                        this.musicButton.classList.add('muted');
                    }, 50);
                    console.log('Music paused');
                }
            },
            showMutedState() {
                this.isPlaying = false;
                this.isMuted = true;
                this.musicButton.classList.add('muted');
            },
            updateVisibility() {
                if (this.musicButton) {
                    this.musicButton.classList.add('show');
                }
            },
            isMobile() {
                return window.innerWidth <= 652 || 'ontouchstart' in window;
            },
            destroy() {
                if (this.audio) {
                    this.audio.pause();
                    this.audio = null;
                }
            }
        };
        const masonryController = {
            container: null,
            posts: [],
            columnCount: 3,
            gap: 20,
            resizeObserver: null,
            layoutRaf: null,
            init() {
                this.container = document.getElementById('finalPage');
                if (!this.container) return;
                this.posts = Array.from(this.container.querySelectorAll('.post'));
                this.setupPostImages();
                window.addEventListener('resize', () => {
                    this.scheduleLayout();
                    this.updateMusicButtonStyle();
                });
                if (typeof ResizeObserver !== 'undefined') {
                    this.resizeObserver = new ResizeObserver(() => {
                        this.scheduleLayout();
                    });
                    this.posts.forEach(post => this.resizeObserver.observe(post));
                }
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (this.container.classList.contains('show')) {
                                setTimeout(() => {
                                    this.scheduleLayout();
                                }, 100);
                            }
                        }
                    });
                });
                observer.observe(this.container, {
                    attributes: true,
                    attributeFilter: ['class']
                });
                if (this.container.classList.contains('show')) {
                    this.layoutPosts();
                }
                this.updateMusicButtonStyle();
            },
            setupPostImages() {
                this.posts.forEach((post) => {
                    if (!post.querySelector('.post-image')) {
                        const imageWrapper = document.createElement('div');
                        imageWrapper.className = 'post-image';
                        const firstImg = post.querySelector('img');
                        if (firstImg) {
                            imageWrapper.appendChild(firstImg);
                        }
                        post.insertBefore(imageWrapper, post.firstChild);
                    }
                    const img = post.querySelector('.post-image img');
                    if (img) {
                        const update = () => {
                            requestAnimationFrame(() => this.updatePostImagePadding(post));
                        };
                        if (img.complete) {
                            update();
                        } else {
                            img.addEventListener('load', update, { once: true });
                            img.addEventListener('error', () => {
                                const wrapper = post.querySelector('.post-image');
                                if (wrapper) wrapper.classList.add('image-error');
                                this.scheduleLayout();
                            }, { once: true });
                        }
                    } else {
                        const wrapper = post.querySelector('.post-image');
                        if (wrapper) wrapper.classList.add('image-error');
                        post.style.paddingTop = '';
                    }
                });
            },
            updatePostImagePadding(post) {
                const img = post.querySelector('.post-image img');
                const imageWrapper = post.querySelector('.post-image');
                if (!img || !imageWrapper) return;
                imageWrapper.style.height = '';
                post.style.paddingTop = '';
                img.style.width = '100%';
                img.style.height = 'auto';
            },
            getColumnCount() {
                return window.innerWidth <= 652 ? 2 : 3;
            },
            getGap() {
                return window.innerWidth <= 652 ? 15 : 20;
            },
            layoutPosts() {
                if (!this.container || this.posts.length === 0) return;
                const currentColumnCount = this.getColumnCount();
                const currentGap = this.getGap();
                const containerWidth = this.container.clientWidth - 20;
                const columnWidth = (containerWidth - (currentColumnCount - 1) * currentGap) / currentColumnCount;
                const columnHeights = new Array(currentColumnCount).fill(0);
                this.posts.forEach(post => {
                    post.style.width = `${columnWidth}px`;
                    this.updatePostImagePadding(post);
                });
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        this.posts.forEach((post) => {
                            const shortestColumnIndex = columnHeights.indexOf(Math.min(...columnHeights));
                            post.style.left = `${shortestColumnIndex * (columnWidth + currentGap) + 10}px`;
                            post.style.top = `${columnHeights[shortestColumnIndex] + 10}px`;
                            const postHeight = post.offsetHeight;
                            columnHeights[shortestColumnIndex] += postHeight + currentGap;
                        });
                    });
                });
                this.updateMusicButtonStyle();
            },
            updateMusicButtonStyle() {
                const musicButton = document.querySelector('.music');
                const isFinalShown = this.container && this.container.classList.contains('show');
                if (musicButton) {
                    if (isFinalShown && window.innerWidth <= 652) {
                        document.body.classList.add('final-page-exists');
                    } else {
                        document.body.classList.remove('final-page-exists');
                    }
                }
            },
            scheduleLayout() {
                if (this.layoutRaf) return;
                this.layoutRaf = requestAnimationFrame(() => {
                    this.layoutRaf = null;
                    this.layoutPosts();
                });
            }
        };
        document.addEventListener('DOMContentLoaded', function () {
            try {
                loadingController.init();
                backgroundController.init();
                const welcomeCanvas = document.querySelector(".welcome_canvas");
                if (welcomeCanvas) {
                    particleController.init().catch(error => {
                        console.warn('Particle system initialization failed:', error);
                    });
                }
                targetCursorController.init();
                buttonZIndexController.init();
                linkModalController.init();
                inputModalController.init();
                skipModalController.init();
                returnModalController.init();
                nameModalController.init();
                gameInfoController.init();
                resetModalController.init();
                questionnaireController.init();
                musicController.init();
                masonryController.init();
                console.log('All systems initialized successfully');
            } catch (error) {
                console.error('System initialization failed:', error);
            }
        });
        window.addEventListener('beforeunload', function () {
            backgroundController.destroy();
            particleController.destroy();
            targetCursorController.destroy();
            musicController.destroy();
        });
        class AudioInteractionSystem {
            constructor() {
                this.audioCache = {};
                this.isSmallScreen = window.innerWidth < 652;
                this.init();
            }
            init() {
                this.preloadAudio();
                this.bindEvents();
                this.handleResize();
                this.addCursorTargetClasses();
            }
            preloadAudio() {
                const audioUrls = {
                    hover: 'https://cdn.jsdelivr.net/gh/pumpkinnap/music/BOSShover.mp3',
                    click: 'https://cdn.jsdelivr.net/gh/pumpkinnap/music/BOSSclick.mp3',
                    tip: 'https://cdn.jsdelivr.net/gh/pumpkinnap/music/BOSStip.mp3'
                };
                Object.entries(audioUrls).forEach(([key, url]) => {
                    const audio = new Audio(url);
                    audio.preload = 'auto';
                    audio.volume = 0.7;
                    this.audioCache[key] = audio;
                });
            }
            playAudio(type) {
                const audio = this.audioCache[type];
                if (audio) {
                    audio.currentTime = 0;
                    audio.play().catch(e => console.log('Audio play failed:', e));
                }
            }
            addCursorTargetClasses() {
                const selectors = ['.choice', '.up', '.music', '.post', '.link-modal-button', '.skip-modal-button', '.name-modal-button', '.modal-button', '.cg-refresh-btn', '.cg-load-btn', '.cg-item'];
                selectors.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => el.classList.add('cursor-target'));
                });
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) {
                                selectors.forEach(selector => {
                                    if (node.matches && node.matches(selector)) {
                                        node.classList.add('cursor-target');
                                    }
                                    const elements = node.querySelectorAll && node.querySelectorAll(selector);
                                    if (elements) {
                                        elements.forEach(el => el.classList.add('cursor-target'));
                                    }
                                });
                            }
                        });
                    });
                });
                observer.observe(document.body, { childList: true, subtree: true });
            }
            bindEvents() {
                this.bindHoverEvents();
                this.bindClickEvents();
                this.bindModalEvents();
                window.addEventListener('resize', () => this.handleResize());
            }
            bindHoverEvents() {
                document.addEventListener('mouseenter', (e) => {
                    if (this.isSmallScreen) return;
                    if (e.target.classList.contains('cursor-target') ||
                        e.target.closest('.cursor-target')) {
                        this.playAudio('hover');
                    }
                }, true);
            }
            bindClickEvents() {
                document.addEventListener('click', (e) => {
                    const target = e.target;
                    const cursorTarget = target.classList.contains('cursor-target') || target.closest('.cursor-target');
                    const choiceButton = target.classList.contains('choice') || target.closest('.choice');
                    if (this.isSmallScreen && choiceButton) {
                        this.handleChoiceClick(target.closest('.choice') || target);
                    } else if (cursorTarget) {
                        this.playAudio('click');
                    }
                });
            }
            handleChoiceClick(choiceElement) {
                const choiceId = choiceElement.dataset.choiceId || choiceElement.textContent.trim();
                const isSelected = choiceElement.classList.contains('selected');
                if (!isSelected) {
                    this.playAudio('hover');
                } else {
                    this.playAudio('click');
                }
            }
            bindModalEvents() {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) {
                                if (node.classList && (node.classList.contains('modal') ||
                                    node.classList.contains('link-modal') ||
                                    node.classList.contains('skip-modal') ||
                                    node.classList.contains('name-modal') ||
                                    node.classList.contains('player-settings-modal') ||
                                    node.classList.contains('cg-roll-modal') ||
                                    node.style.position === 'fixed')) {
                                    this.playAudio('tip');
                                }
                                const modals = node.querySelectorAll && node.querySelectorAll('.modal, .link-modal, .skip-modal, .name-modal, .player-settings-modal, .cg-roll-modal, [style*="position: fixed"]');
                                if (modals && modals.length > 0) {
                                    this.playAudio('tip');
                                }
                            }
                        });
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            const target = mutation.target;
                            if (target.classList.contains('show') &&
                                (target.classList.contains('modal') ||
                                    target.classList.contains('link-modal') ||
                                    target.classList.contains('skip-modal') ||
                                    target.classList.contains('name-modal') ||
                                    target.classList.contains('player-settings-modal') ||
                                    target.classList.contains('cg-roll-modal'))) {
                                this.playAudio('tip');
                            }
                        }
                    });
                });
                observer.observe(document.body, {
                    childList: true,
                    subtree: true,
                    attributes: true,
                    attributeFilter: ['class', 'style']
                });
            }
            handleResize() {
                this.isSmallScreen = window.innerWidth < 652;
            }
        }
        new AudioInteractionSystem();
        function showPlayerSettingsModal() {
            const modal = document.getElementById('playerSettingsModal');
            const content = modal.querySelector('.player-settings-modal-content');
            modal.classList.add('show');
            content.classList.remove('hide-animation');
            content.classList.add('show-animation');
            updatePreview();
        }
        function hidePlayerSettingsModal() {
            const modal = document.getElementById('playerSettingsModal');
            const content = modal.querySelector('.player-settings-modal-content');
            content.classList.remove('show-animation');
            content.classList.add('hide-animation');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('hide-animation');
            }, 300);
        }
        function updatePreview() {
            const appearance = document.getElementById('userAppearance').value.trim();
            const executionCG = document.getElementById('executionCG').value.trim();
            const defeatCG = document.getElementById('defeatCG').value.trim();
            const additionalSettings = document.getElementById('additionalSettings').value.trim();
            const settingsObject = {
                "appearance_directive": {
                    "instruction": "When  describing user-related plot elements, extract relevant physical characteristics that connect to the current narrative context and weave them organically into the prose through indirect exposition rather than explicit description.",
                    "user_appearance": appearance || ""
                },
                "additional_settings": additionalSettings || "",
                "scene_configurations": {
                    "execution_cg": executionCG || "",
                    "defeat_cg": defeatCG || ""
                }
            };
            const jsonString = JSON.stringify(settingsObject, null, 2);
            const previewElement = document.getElementById('settingsPreview');
            if (appearance || executionCG || defeatCG || additionalSettings) {
                previewElement.textContent = jsonString;
                previewElement.classList.remove('preview-placeholder');
            } else {
                previewElement.innerHTML = '<div class="preview-placeholder"></div>';
            }
        }
        function copyPlayerSettings() {
            const appearance = document.getElementById('userAppearance').value.trim();
            const executionCG = document.getElementById('executionCG').value.trim();
            const defeatCG = document.getElementById('defeatCG').value.trim();
            const additionalSettings = document.getElementById('additionalSettings').value.trim();
            const settingsObject = {
                "appearance_directive": {
                    "instruction": "When  describing user-related plot elements, extract relevant physical characteristics that connect to the current narrative context and weave them organically into the prose through indirect exposition rather than explicit description.",
                    "user_appearance": appearance || ""
                },
                "additional_settings": additionalSettings || "",
                "scene_configurations": {
                    "execution_cg": executionCG || "",
                    "defeat_cg": defeatCG || ""
                }
            };
            const jsonString = JSON.stringify(settingsObject, null, 2);
            navigator.clipboard.writeText(jsonString).then(() => {
                const copyButton = document.querySelector('.copy-button');
                const originalText = copyButton.textContent;
                copyButton.textContent = '';
                copyButton.style.backgroundColor = '#aeffc5';
                copyButton.style.color = '#1a1a1a';
                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.style.backgroundColor = '';
                    copyButton.style.color = '';
                }, 2000);
            }).catch(err => {
                console.error(':', err);
                alert('\n\n' + jsonString);
            });
        }
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('player-settings-modal')) {
                hidePlayerSettingsModal();
            }
            if (e.target.classList.contains('cg-roll-modal')) {
                hideCGRollModal();
            }
        });
        let selectedExecutionCG = null;
        let selectedDefeatCG = null;
        // CG
        const executionCGPool = [
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0CG" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" },
            { title: "", content: "HP0" }
        ];
        // CG
        const defeatCGPool = [
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "cos", content: "cosplay" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" },
            { title: "", content: "" }
        ];
        function showCGRollModal() {
            const modal = document.getElementById('cgRollModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            modal.classList.add('show');
            content.classList.remove('hide-animation');
            content.classList.add('show-animation');
            refreshExecutionCGs();
            refreshDefeatCGs();
            updateSelectionDisplay();
        }
        function hideCGRollModal() {
            const modal = document.getElementById('cgRollModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            content.classList.remove('show-animation');
            content.classList.add('hide-animation');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('hide-animation');
            }, 300);
        }
        function getRandomCGs(pool, count = 4) {
            const shuffled = [...pool].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
        function refreshExecutionCGs() {
            const container = document.getElementById('executionCGList');
            const randomCGs = getRandomCGs(executionCGPool, 4);
            container.innerHTML = '';
            randomCGs.forEach((cg, index) => {
                const cgElement = document.createElement('div');
                cgElement.className = 'cg-item cursor-target';
                cgElement.innerHTML = `
                    <div class="cg-item-title">${cg.title}</div>
                    <div>${cg.content}</div>
                `;
                cgElement.onclick = () => selectExecutionCG(cg, cgElement);
                container.appendChild(cgElement);
            });
        }
        function refreshDefeatCGs() {
            const container = document.getElementById('defeatCGList');
            const randomCGs = getRandomCGs(defeatCGPool, 4);
            container.innerHTML = '';
            randomCGs.forEach((cg, index) => {
                const cgElement = document.createElement('div');
                cgElement.className = 'cg-item';
                cgElement.innerHTML = `
                    <div class="cg-item-title">${cg.title}</div>
                    <div>${cg.content}</div>
                `;
                cgElement.onclick = () => selectDefeatCG(cg, cgElement);
                container.appendChild(cgElement);
            });
        }
        function selectExecutionCG(cg, element) {
            document.querySelectorAll('#executionCGList .cg-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedExecutionCG = cg;
            updateSelectionDisplay();
        }
        function selectDefeatCG(cg, element) {
            document.querySelectorAll('#defeatCGList .cg-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedDefeatCG = cg;
            updateSelectionDisplay();
        }
        function updateSelectionDisplay() {
            const executionDisplay = document.getElementById('selectedExecutionCG');
            const defeatDisplay = document.getElementById('selectedDefeatCG');
            executionDisplay.textContent = selectedExecutionCG ?
                `${selectedExecutionCG.title}${selectedExecutionCG.content}` : '';
            defeatDisplay.textContent = selectedDefeatCG ?
                `${selectedDefeatCG.title}${selectedDefeatCG.content}` : '';
        }
        function loadSelectedCGs() {
            const loadButton = document.querySelector('.cg-load-btn');
            const successMessage = document.getElementById('cgSuccessMessage');
            if (!selectedExecutionCG && !selectedDefeatCG) {
                loadButton.classList.add('error');
                setTimeout(() => {
                    loadButton.classList.remove('error');
                }, 1000);
                return;
            }
            const executionCGInput = document.getElementById('executionCG');
            const defeatCGInput = document.getElementById('defeatCG');
            if (selectedExecutionCG && executionCGInput) {
                executionCGInput.value = `${selectedExecutionCG.title}${selectedExecutionCG.content}`;
                executionCGInput.dispatchEvent(new Event('input'));
            }
            if (selectedDefeatCG && defeatCGInput) {
                defeatCGInput.value = `${selectedDefeatCG.title}${selectedDefeatCG.content}`;
                defeatCGInput.dispatchEvent(new Event('input'));
            }
            const originalText = loadButton.textContent;
            loadButton.textContent = '';
            loadButton.classList.add('success');
            successMessage.classList.add('show');
            setTimeout(() => {
                loadButton.textContent = originalText;
                loadButton.classList.remove('success');
                successMessage.classList.remove('show');
                hideCGRollModal();
            }, 2000);
        }
        function showBaseCommandModal() {
            const modal = document.getElementById('baseCommandModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            modal.classList.add('show');
            content.classList.remove('hide-animation');
            content.classList.add('show-animation');
            if (typeof musicController !== 'undefined' && musicController.audio) {
            }
        }
        function hideBaseCommandModal() {
            const modal = document.getElementById('baseCommandModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            content.classList.remove('show-animation');
            content.classList.add('hide-animation');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('hide-animation');
            }, 300);
        }
        function showAnnouncementModal() {
            const modal = document.getElementById('announcementModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            modal.classList.add('show');
            content.classList.remove('hide-animation');
            content.classList.add('show-animation');
            if (typeof musicController !== 'undefined' && musicController.audio) {
            }
        }
        function hideAnnouncementModal() {
            const modal = document.getElementById('announcementModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            content.classList.remove('show-animation');
            content.classList.add('hide-animation');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('hide-animation');
            }, 300);
        }
        function showQAModal() {
            const modal = document.getElementById('qaModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            modal.classList.add('show');
            content.classList.remove('hide-animation');
            content.classList.add('show-animation');
            if (typeof musicController !== 'undefined' && musicController.audio) {
            }
        }
        function hideQAModal() {
            const modal = document.getElementById('qaModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            content.classList.remove('show-animation');
            content.classList.add('hide-animation');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('hide-animation');
            }, 300);
        }
        function showOtherWorksModal() {
            const modal = document.getElementById('otherWorksModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            modal.classList.add('show');
            content.classList.remove('hide-animation');
            content.classList.add('show-animation');
            if (typeof musicController !== 'undefined' && musicController.audio) {
            }
        }
        function hideOtherWorksModal() {
            const modal = document.getElementById('otherWorksModal');
            const content = modal.querySelector('.cg-roll-modal-content');
            content.classList.remove('show-animation');
            content.classList.add('hide-animation');
            setTimeout(() => {
                modal.classList.remove('show');
                content.classList.remove('hide-animation');
            }, 300);
        }
        document.addEventListener('DOMContentLoaded', function () {
            const cgModal = document.getElementById('cgRollModal');
            if (cgModal) {
                cgModal.addEventListener('click', (e) => {
                    if (e.target === cgModal) {
                        hideCGRollModal();
                    }
                });
            }
            const baseCommandModal = document.getElementById('baseCommandModal');
            if (baseCommandModal) {
                baseCommandModal.addEventListener('click', (e) => {
                    if (e.target === baseCommandModal) {
                        hideBaseCommandModal();
                    }
                });
            }
            const announcementModal = document.getElementById('announcementModal');
            if (announcementModal) {
                announcementModal.addEventListener('click', (e) => {
                    if (e.target === announcementModal) {
                        hideAnnouncementModal();
                    }
                });
            }
            const qaModal = document.getElementById('qaModal');
            if (qaModal) {
                qaModal.addEventListener('click', (e) => {
                    if (e.target === qaModal) {
                        hideQAModal();
                    }
                });
            }
            const otherWorksModal = document.getElementById('otherWorksModal');
            if (otherWorksModal) {
                otherWorksModal.addEventListener('click', (e) => {
                    if (e.target === otherWorksModal) {
                        hideOtherWorksModal();
                    }
                });
            }
        });
    </script>
</body>
</html>
